<!doctype html>
<html lang="ar" dir="rtl">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ุชูุฑูุฑ ุชุณุฌูู ุฏุฎูู ุนุฏุงุฏ โ ุงูุตูุงูุฉ</title>

  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap" rel="stylesheet" />

  <!-- CSS -->
  <link rel="stylesheet" href="G1_Calib.css" />

  <!-- Libraries -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <script type="module" src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.esm.js"></script>
</head>

<body>
  <main class="app">
    <!-- RIGHT SIDE : TABLE -->
    <div class="right-side">
      <section class="table-top-section">
        <div class="table-header">
          <ion-icon name="list-outline"></ion-icon>

          <div class="modern-dropdown">
            <button class="dropdown-btn" id="dropdownBtn">
              โพ ุงุฎุชุฑ ุงูุตูุญุฉ ููุงูุชูุงู
            </button>

            <div class="dropdown-menu" id="dropdownMenu">
              <div class="dropdown-group" data-icon="๐๏ธ">ุงูุตูุงูุฉ</div>
              <div class="dropdown-item" data-page="Entr_Maint.html">
                ุฏุฎูู ุตูุงูุฉ ุนุฏุงุฏ
              </div>
              <div class="dropdown-item" data-page="Maint.html">
                ุตูุงูุฉ ุนุฏุงุฏ
              </div>
              <div class="dropdown-item" data-page="Edite_Maint.html">
                ุชุนุฏูู ุจูุงูุงุช ุตูุงูุฉ ุนุฏุงุฏ
              </div>
              <div class="dropdown-item" data-page="Print_Out_SMaint.html">
                ุทุจุงุนุฉ ุชูุฑูุฑ ูุญุต ุตูุงูุฉ ุนุฏุงุฏ
              </div>
              <div class="dropdown-item" data-page="Print_Out_TMaint.html">
                ุทุจุงุนุฉ ุชูุฑูุฑ ูุฌูุน ุตูุงูุฉ ุนุฏุงุฏ
              </div>
              <div class="dropdown-item" onclick="window.open('Re_Print_Out_SMaint.html', '_blank')">
                ุฅุนุงุฏุฉ ุทุจุงุนุฉ ุชูุฑูุฑ ูุญุต ุตูุงูุฉ ุนุฏุงุฏ
              </div>
              <div class="dropdown-item" data-page="Re_Print_Out_TMaint.html">
                ุฅุนุงุฏุฉ ุทุจุงุนุฉ ุชูุฑูุฑ ูุฌูุน ุตูุงูุฉ ุนุฏุงุฏ
              </div>

              <div class="dropdown-group" data-icon="๐">ุชูุงุฑูุฑ ุงูุตูุงูุฉ</div>
              <div class="dropdown-item" data-page="R_Entr_Maint.html">
                ุชูุฑูุฑ ุฏุฎูู ุตูุงูุฉ ุนุฏุงุฏ
              </div>
              <div class="dropdown-item" data-page="R_Maint.html">
                ุชูุฑูุฑ ุตูุงูุฉ ุนุฏุงุฏ
              </div>

              <div class="dropdown-group" data-icon="๐๏ธ">ุงูุฃุฑุดูู</div>
              <div class="dropdown-item" data-page="R_Maint_Archive.html">
                ุฃุฑุดูู ุงูุตูุงูุฉ
              </div>
              <div class="dropdown-item" data-page="Main_Dashboard.html" data-icon="๐">
                ุงูุตูุญุฉ ุงูุฑุฆูุณูุฉ
              </div>
            </div>
          </div>

          <input type="date" id="current_date" class="calib_date" readonly />
          <script>
            // Get today's date in the format YYYY-MM-DD (required for <input type="date">)
            const today = new Date();
            const Year = today.getFullYear();
            const month = String(today.getMonth() + 1).padStart(2, "0"); // Add leading zero if month is single digit
            const day = String(today.getDate()).padStart(2, "0"); // Add leading zero if day is single digit
            const formattedDate = `${Year}-${month}-${day}`;

            // Set the value of the input field to today's date
            document.getElementById("current_date").value = formattedDate;
          </script>

          <div class="table-header-controls">
            <input id="searchInput" placeholder="๐ ุจุญุซ ุจุฑูู ุงูุนุฏุงุฏ" />
            <button id="exportBtn">
              <ion-icon name="download-outline"></ion-icon> ุชุตุฏูุฑ Excel
            </button>
          </div>
        </div>
      </section>

      <section class="table-wrapper">
        <div class="table-container">
          <table id="dataTable">
            <thead>
              <tr>
                <th>ู</th>
                <th>ุฑูู ุงูุนุฏุงุฏ</th>
                <th>ุณูุฉ ุงูุตูุน</th>
                <th>ุงููุฑุงุกุฉ</th>
                <th>ุงููุฏุฑุฉ</th>
                <th>ููุน ุงูุนุฏุงุฏ</th>
                <th>ููุน ุงูุชูุตูู</th>
                <th>ุงููุทุงุน</th>
                <th>ุงูููุฏุณุฉ</th>
                <th>ุณุจุจ ุงูุฑูุน</th>
                <th>ุชุงุฑูุฎ ุงูุฑูุน</th>
                <th>ุชูุฑูุฑ ุงูููุฏุณุฉ</th>
                <th>ุชุงุฑูุฎ ุฏุฎูู ุงูุตูุงูุฉ</th>
                <th>ููุงุญุธุงุช</th>
                <th>ุงูุญุงูุฉ</th>
              </tr>
            </thead>
            <tbody id="tableBody"></tbody>
          </table>
        </div>
      </section>

      <div class="row-counter-dashboard">
        <div class="dashboard-card">
          <h3>ุนุฏุฏ ุงูุณุฌูุงุช</h3>
          <span id="rowCountValue">0</span>
        </div>
      </div>

      <div class="scroll-buttons">
        <button id="scrollUp" class="scroll-btn" type="button" title="ุฃุนูู">
          <ion-icon name="chevron-up-outline"></ion-icon>
        </button>
        <button id="scrollDown" class="scroll-btn" type="button" title="ุฃุณูู">
          <ion-icon name="chevron-down-outline"></ion-icon>
        </button>
      </div>
    </div>

    <!-- LEFT SIDE : FORM -->
    <div class="left-side">
      <section class="glass">
        <div class="header-top">
          <div class="logo">
            <ion-icon name="construct-outline"></ion-icon>
          </div>
          <div>
            ูุฒุงุฑุฉ ุงูููุฑุจุงุก ูุงูุทุงูุฉ ุงููุชุฌุฏุฏุฉ<br />
            ุงูุดุฑูุฉ ุงููุงุจุถุฉ ูููุฑุจุงุก ูุตุฑ<br />
            ุดุฑูุฉ ุดูุงู ุงูุฏูุชุง ูุชูุฒูุน ุงูููุฑุจุงุก
          </div>
        </div>

        <h1 class="title-main">ุงูุฅุฏุงุฑุฉ ุงูุนุงูุฉ ูุฃูุธูุฉ ุงูุนุฏุงุฏุงุช ุงูุญุฏูุซุฉ</h1>

        <h3>ุจูุงูุงุช ุงูุนุฏุงุฏุงุช ุงููุณุฌูุฉ ููุตูุงูุฉ</h3>

        <select id="mtype" aria-label="ุงุฎุชุฑ ููุน ุงูุนุฏุงุฏ">
          <option value="">โพ ุงุฎุชุฑ ููุน ุงูุนุฏุงุฏ</option>
          <option>ุฌููุจุงู-ูุณุจู</option>
          <option>ุณููุฏู-ูุณุจู</option>
          <option>ุงููุตุฑูุฉ-ูุณุจู</option>
          <option>ุงุณูุฑุง-ูุณุจู</option>
          <option>ุฌูุฒุฉ ุจุงูุฑ-ูุณุจู</option>
          <option>ูููุงูููู</option>
          <option>ุฑููู</option>
          <option>ุนุฏุงุฏุงุช-ุฐููุฉ</option>
          <option>ุฃุฎุฑู</option>
        </select>

        <select id="mconn" aria-label="ููุน ุงูุชูุตูู">
          <option value="">โพ ููุน ุงูุชูุตูู</option>
          <option>ุฃุญุงุฏู</option>
          <option>ุซูุงุซู-ูุจุงุดุฑ</option>
          <option>ุซูุงุซู-ุบูุฑ ูุจุงุดุฑ</option>
        </select>

        <input id="year" placeholder="ุณูุฉ ุงูุตูุน" />

        <label for="startDate">ุชุงุฑูุฎ ุฏุฎูู ุงูุตูุงูุฉ</label>
        <label for="startDate">ูู</label>
        <input type="date" id="startDate" />
        <label for="startDate">ุชุงุฑูุฎ ุฏุฎูู ุงูุตูุงูุฉ</label>
        <label for="startDate">ุงูู</label>
        <input type="date" id="endDate" placeholder="ุฅูู ุชุงุฑูุฎ" />

        <select id="keta3" aria-label="ุงููุทุงุน">
          <option value="">โพ ุงููุทุงุน</option>
          <option>ุฏููุงุท</option>
          <option>ุดูุงู-ุงูุฏููููุฉ</option>
          <option>ุฌููุจ-ุงูุฏููููุฉ</option>
          <option>ููุฑ ุงูุดูุฎ</option>
        </select>

        <select id="handsa" aria-label="ุงูููุฏุณุฉ">
          <option value="">โพุงูููุฏุณุฉ</option>
          <!-- ุฏููุงุท -->
          <option>ููุฏุณุฉ ุดูุงู ุฏููุงุท</option>
          <option>ููุฏุณุฉ ุฌููุจ ุฏููุงุท</option>
          <option>ููุฏุณุฉ ุนุฒุจุฉ ุงูุจุฑุฌ</option>
          <option>ููุฏุณุฉ ููุฑ ุณุนุฏ</option>
          <option>ููุฏุณุฉ ููุฑ ุงูุจุทูุฎ</option>
          <option>ููุฏุณุฉ ุฑุงุณ ุงูุจุฑ</option>
          <option>ููุฏุณุฉ ุฏููุงุท ุงูุฌุฏูุฏุฉ</option>
          <option>ููุฏุณุฉ ุงูุฒุฑูุง</option>
          <option>ููุฏุณุฉ ูุงุฑุณููุฑ</option>
          <option>ููุฏุณุฉ ุงูุฑูุถุฉ</option>
          <option>ููุฏุณุฉ ุงูุดุนุฑุงุก</option>

          <!-- ุดูุงู ุงูุฏููููุฉ -->
          <option>ููุฏุณุฉ ูุฏููุฉ ุดุฑุจูู</option>
          <option>ููุฏุณุฉ ูุฑู ุดุฑุจูู</option>
          <option>ููุฏุณุฉ ุฏูุฑูุณ</option>
          <option>ููุฏุณุฉ ุฌูุตุฉ</option>
          <option>ููุฏุณุฉ ูุฑู ุจููุงุณ</option>
          <option>ููุฏุณุฉ ูุฏููุฉ ุจููุงุณ</option>
          <option>ููุฏุณุฉ ุงูุณุชุงูููู</option>
          <option>ููุฏุณุฉ ุจูู ุนุจูุฏ</option>
          <option>ููุฏุณุฉ ูููุฉ ุงููุตุฑ</option>
          <option>ููุฏุณุฉ ููุช ุณูุณูู</option>
          <option>ููุฏุณุฉ ุงูุฌูุงููุฉ</option>
          <option>ููุฏุณุฉ ูุฑู ุงูููุฒูุฉ</option>
          <option>ููุฏุณุฉ ูุฏููุฉ ุงูููุฒูุฉ</option>
          <option>ููุฏุณุฉ ุงููุทุฑูุฉ</option>

          <!-- ุฌููุจ ุงูุฏููููุฉ -->
          <option>ููุฏุณุฉ ุดุฑู ุงูููุตูุฑุฉ</option>
          <option>ููุฏุณุฉ ุบุฑุจ ุงูููุตูุฑุฉ</option>
          <option>ููุฏุณุฉ ุทูุฎุง</option>
          <option>ููุฏุณุฉ ูุจุฑูู</option>
          <option>ููุฏุณุฉ ูุฑู ุงูููุตูุฑุฉ 1</option>
          <option>ููุฏุณุฉ ูุฑู ุงูููุตูุฑุฉ 2</option>
          <option>ููุฏุณุฉ ุงุฌุง</option>
          <option>ููุฏุณุฉ ูุฏููุฉ ุงูุณูุจูุงููู</option>
          <option>ููุฏุณุฉ ูุฑู ุงูุณูุจูุงููู</option>
          <option>ููุฏุณุฉ ุชูู ุงูุงูุฏูุฏ</option>
          <option>ููุฏุณุฉ ูุฏููุฉ ููุช ุบูุฑ</option>
          <option>ููุฏุณุฉ ูุฑู ููุช ุบูุฑ</option>
          <option>ููุฏุณุฉ ููู ุงูููุฑ</option>

          <!-- ููุฑ ุงูุดูุฎ -->
          <option>ููุฏุณุฉ ูุฏููุฉ ููุฑ ุงูุดูุฎ</option>
          <option>ููุฏุณุฉ ุบุฑุจ ููุฑ ุงูุดูุฎ</option>
          <option>ููุฏุณุฉ ุดุฑู ููุฑ ุงูุดูุฎ</option>
          <option>ููุฏุณุฉ ูููู</option>
          <option>ููุฏุณุฉ ูุฑู ุณูุฏู ุณุงูู</option>
          <option>ููุฏุณุฉ ูุฏููุฉ ุณูุฏู ุณุงูู</option>
          <option>ููุฏุณุฉ ุงูุฑูุงุถ</option>
          <option>ููุฏุณุฉ ูุฏููุฉ ุฏุณูู</option>
          <option>ููุฏุณุฉ ูุฑู ุดูุงู ุฏุณูู</option>
          <option>ููุฏุณุฉ ูุฑู ุฌููุจ ุฏุณูู</option>
          <option>ููุฏุณุฉ ููู</option>
          <option>ููุฏุณุฉ ูุทูุจุณ</option>
          <option>ููุฏุณุฉ ูุฏููุฉ ุงูุญุงููู</option>
          <option>ููุฏุณุฉ ูุฑู ุงูุญุงููู</option>
          <option>ููุฏุณุฉ ุจููุง</option>
          <option>ููุฏุณุฉ ุจูุทูู</option>
          <option>ููุฏุณุฉ ุจุฑุฌ ุงูุจุฑูุณ</option>
        </select>

        <select id="removingfor" aria-label="ุณุจุจ ุงูุฑูุน">
          <option value="">โพุณุจุจ ุงูุฑูุน</option>
          <option>ุงููุญุต</option>
          <option>ุงูุตูุงูุฉ</option>
          <option>ุงููุฏู ูุงูุจูุงุก</option>
          <option>ุชุตููุฉ ูุดุชุฑู</option>
          <option>ุฒูุงุฏุฉ ูุฏุฑุฉ</option>
          <option>ุงุญูุงู ุฑุจุงุนู</option>
          <option>ุชูุงุฒู</option>
          <option>ุฎุทุฉ ุงุญูุงู</option>
          <option>ุงุญูุงู ุนุฏู ุณุฏุงุฏ</option>
        </select>

        <select id="mremovingfor" aria-label="ุชูุฑูุฑ ูุญุต ุงูููุฏุณุฉ">
          <option value="">โพ ุชูุฑูุฑ ูุญุต ุงูููุฏุณุฉ</option>
          <option>ุนุทู ุจุงูุจุทุงุฑูุฉ ุงุฑุณุงูุฉ ููุดุฑูุฉ ุงูููุฑุฏุฉ ููุตูุงูุฉ</option>
          <option>ูุงุฑูุก ุงููุฑูุช ูุง ูุนูู ุงุฑุณุงูุฉ ููุดุฑูุฉ ุงูููุฑุฏุฉ ููุตูุงูุฉ</option>
          <option>ุงูุนุฏุงุฏ ูุง ููุจู ุงูุดุญู ุงุฑุณุงูุฉ ููุดุฑูุฉ ุงูููุฑุฏุฉ ููุตูุงูุฉ</option>
          <option>
            ุงูุนุฏุงุฏ ูุง ูููู ุจุงูุชูุตูู ุงุฑุณุงูุฉ ููุดุฑูุฉ ุงูููุฑุฏุฉ ููุตูุงูุฉ
          </option>
          <option>ุงูุดุงุดุฉ ุนุงุทูุฉ ุงุฑุณุงูุฉ ููุดุฑูุฉ ุงูููุฑุฏุฉ ููุตูุงูุฉ</option>
          <option>ุงูุนุฏุงุฏ ูุญุชุงุฌ ููุชููุฆุฉ ุงุฑุณุงูุฉ ููุดุฑูุฉ ุงูููุฑุฏุฉ ููุตูุงูุฉ</option>
          <option>ุชูุฑูุฑ ูุญุต ููุนุฏุงุฏ ูู ูุจู ุงูุดุฑูุฉ ุงูููุฑุฏุฉ</option>
          <option>ุชูู ุจุฌุณู/ุฑูุฒุชุฉ ุงูุนุฏุงุฏ ุงุฑุณุงูุฉ ููุดุฑูุฉ ุงูููุฑุฏุฉ ููุตูุงูุฉ</option>
          <option>ุฒูุงุฏุฉ ูุฏุฑุฉ ุงุฑุณุงูุฉ ููุดุฑูุฉ ุงูููุฑุฏุฉ ููุตูุงูุฉ</option>
          <option>ุจุญุซ ูุฏููููุฉ ุจุงูุนุฏุงุฏ ุงุฑุณุงูุฉ ููุดุฑูุฉ ุงูููุฑุฏุฉ ููุตูุงูุฉ</option>
          <option>ุงูุนุฏุงุฏ ูุญุชุฑู ุงุฑุณุงูุฉ ููุดุฑูุฉ ุงูููุฑุฏุฉ ููุตูุงูุฉ</option>
          <option>ุงูุนุฏุงุฏ ูุง ูุนูู ุงุฑุณุงูุฉ ููุดุฑูุฉ ุงูููุฑุฏุฉ ููุตูุงูุฉ</option>
          <option>
            ููุจุฉ ุงูุชูุงุนุจ ุชุนูู ุจุงุณุชูุฑุงุฑ ุงุฑุณุงูุฉ ููุดุฑูุฉ ุงูููุฑุฏุฉ ููุตูุงูุฉ
          </option>
          <option>ุงูุนุฏุงุฏ ูุนูู ุจุฏูู ุดุญู ุงุฑุณุงูุฉ ููุดุฑูุฉ ุงูููุฑุฏุฉ ููุตูุงูุฉ</option>
          <option>
            ุงูุนุฏุงุฏ ูุง ูุณุฌู ุงูุงุณุชููุงู ุงุฑุณุงูุฉ ููุดุฑูุฉ ุงูููุฑุฏุฉ ููุตูุงูุฉ
          </option>
          <option>
            ุงูุนุฏุงุฏ ูุณุฌู ุงุณุชููุงู ุจุฏูู ุญูู ุงุฑุณุงูุฉ ููุดุฑูุฉ ุงูููุฑุฏุฉ ููุตูุงูุฉ
          </option>
          <option>blocking</option>
        </select>

        <div class="buttons">
          <button id="clearBtn" class="secondary">ุชูุฑูุบ</button>
        </div>
      </section>
    </div>
  </main>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.3.1/firebase-app.js";
    import {
      getDatabase,
      ref,
      get,
    } from "https://www.gstatic.com/firebasejs/10.3.1/firebase-database.js";

    const firebaseConfig = {
      apiKey: "AIzaSyCTSWDR3IvFpzp8UARsClrpwbRtTwr12jA",
      authDomain: "ndedc-meter-calib.firebaseapp.com",
      databaseURL: "https://ndedc-meter-calib-default-rtdb.firebaseio.com",
      projectId: "ndedc-meter-calib",
      storageBucket: "ndedc-meter-calib.appspot.com",
      messagingSenderId: "185425429190",
      appId: "1:185425429190:web:dce85f29eea55ad9f54dc7",
      measurementId: "G-C6QEKW26MW",
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    /* ================= ELEMENTS ================= */
    const tableBody = document.getElementById("tableBody");
    const searchInput = document.getElementById("searchInput");
    const rowCount = document.getElementById("rowCountValue");

    const mtype = document.getElementById("mtype");
    const mconn = document.getElementById("mconn");
    const keta3 = document.getElementById("keta3");
    const handsa = document.getElementById("handsa");
    const removingfor = document.getElementById("removingfor");
    const mremovingfor = document.getElementById("mremovingfor");
    const startDate = document.getElementById("startDate");
    const endDate = document.getElementById("endDate");
    const year = document.getElementById("year");

    const exportBtn = document.getElementById("exportBtn");
    const clearBtn = document.getElementById("clearBtn");

    const scrollUpBtn = document.getElementById("scrollUp");
    const scrollDownBtn = document.getElementById("scrollDown");

    /* ================= DATA ================= */
    let allData = [];
    let filteredData = [];

    /* ================= HELPERS ================= */
    const formatDate = (d) =>
      d ? new Date(d).toLocaleDateString("ar-EG") : "";

    /* ================= FETCH ================= */
    async function fetchAllData() {
      tableBody.innerHTML = `<tr><td colspan="12">ุฌุงุฑู ุงูุชุญููู...</td></tr>`;

      try {
        const snapshot = await get(ref(db, "Enter_Maint"));
        if (!snapshot.exists()) {
          tableBody.innerHTML = `<tr><td colspan="12">ูุง ุชูุฌุฏ ุจูุงูุงุช</td></tr>`;
          rowCount.textContent = "0";
          return;
        }

        allData = [];
        snapshot.forEach((child) => {
          const record = child.val().otherdata || child.val(); // Ensure you're accessing the correct data structure
          allData.push(record);
        });

        filteredData = [...allData]; // Initialize filteredData with all data
        renderTable();
      } catch (e) {
        console.error(e);
        tableBody.innerHTML = `<tr><td colspan="12">ุฎุทุฃ ูู ุฌูุจ ุงูุจูุงูุงุช</td></tr>`;
      }
    }

    /* ================= RENDER ================= */
    function renderTable() {
      tableBody.innerHTML = "";

      if (!filteredData.length) {
        tableBody.innerHTML = `
                <tr>
                    <td colspan="12" style="text-align:center;padding:30px;">
                        ูุง ุชูุฌุฏ ุจูุงูุงุช ูุทุงุจูุฉ
                    </td>
                </tr>`;
        rowCount.textContent = "0";
        return;
      }

      filteredData.forEach((d, i) => {
        tableBody.innerHTML += `
                <tr>
                        <td>${i++}</td>
                        <td>${d.MNO || ""}</td>
                        <td>${d.YEAR || ""}</td>
                        <td>${d.MREADING || ""}</td>
                        <td>${d.MPower || ""}</td>
                        <td>${d.Mtype || ""}</td>
                        <td>${d.Connection || ""}</td>
                        <td>${d.Keta3 || ""}</td>
                        <td>${d.Handsa || ""}</td>
                        <td>${d.Removingfor || ""}</td>
                        <td>${d.Uploaddate || ""}</td>
                        <td>${d.Mremovingfor || ""}</td>
                        <td>${d.Enter_Maint_Date || ""}</td>
                        <td>${d.Notes || ""}</td>
                        <td><span class="status">ููุฏ ุงูุตูุงูุฉ</span></td>
                </tr>`;
      });

      rowCount.textContent = filteredData.length;
    }

    /* ================= FILTER ================= */
    function applyFilters() {
      let result = [...allData];

      // Helper function to normalize string (for searchInput and year)
      const normalizeString = (str) => (str ? str.trim().toLowerCase() : "");

      // Normalize searchInput and year
      const q = normalizeString(searchInput.value);
      const y = normalizeString(year.value);

      // Filter by MNO (Meter Number) with normalization
      if (q) {
        result = result.filter(
          (o) => o.MNO && normalizeString(o.MNO.toString()).includes(q), // Normalize MNO and search input
        );
      }

      // Filter by YEAR with normalization
      if (y) {
        result = result.filter(
          (o) => o.YEAR && normalizeString(o.YEAR.toString()).includes(y), // Normalize YEAR and search input
        );
      }

      // Apply filters for other fields (like Mtype, Connection, etc.)
      if (mtype.value)
        result = result.filter(
          (o) => normalizeString(o.Mtype) === normalizeString(mtype.value),
        );
      if (mconn.value)
        result = result.filter(
          (o) =>
            normalizeString(o.Connection) === normalizeString(mconn.value),
        );
      if (keta3.value)
        result = result.filter(
          (o) => normalizeString(o.Keta3) === normalizeString(keta3.value),
        );
      if (handsa.value)
        result = result.filter(
          (o) => normalizeString(o.Handsa) === normalizeString(handsa.value),
        );
      if (removingfor.value)
        result = result.filter(
          (o) =>
            normalizeString(o.Removingfor) ===
            normalizeString(removingfor.value),
        );
      if (mremovingfor.value)
        result = result.filter(
          (o) =>
            normalizeString(o.Mremovingfor) ===
            normalizeString(mremovingfor.value),
        );

      // Apply date filters (convert dates to Date objects for accurate comparison)
      if (startDate.value) {
        result = result.filter(
          (o) => new Date(o.Enter_Maint_Date) >= new Date(startDate.value), // Ensure Enter_Maint_Date is a valid date
        );
      }

      if (endDate.value) {
        result = result.filter(
          (o) => new Date(o.Enter_Maint_Date) <= new Date(endDate.value), // Ensure Enter_Maint_Date is a valid date
        );
      }

      filteredData = result;
      renderTable();
    }

    /* ================= CLEAR ================= */
    function clearFilters() {
      document
        .querySelectorAll(".left-side select, .left-side input")
        .forEach((el) => {
          if (el.tagName === "SELECT") el.selectedIndex = 0;
          else el.value = "";
        });
      searchInput.value = "";
      year.value = "";

      filteredData = [...allData];
      renderTable();

      Swal.fire({
        icon: "success",
        title: "ุชู ุฅุนุงุฏุฉ ุงูุชุนููู",
        text: "ุชู ุชูุธูู ูุงูุฉ ุงูููุงุชุฑ ูุนุฑุถ ุฌููุน ุงูุจูุงูุงุช",
        timer: 1500,
        showConfirmButton: false,
        toast: true,
        position: "top-end",
      });
    }

    /* ================= EXPORT ================= */
    function exportToExcel() {
      if (!filteredData.length) return;

      const data = filteredData.map((o, i) => ({
        ู: i + 1,
        "ุฑูู ุงูุนุฏุงุฏ": o.MNO || "",
        "ููุน ุงูุนุฏุงุฏ": o.Mtype || "",
        "ููุน ุงูุชูุตูู": o.Connection || "",
        ุงููุฑุงุกุฉ: o.MREADING || "",
        ุงููุฏุฑุฉ: o.MPower || "",
        "ุณูุฉ ุงูุตูุน": o.YEAR || "",
        ุงููุทุงุน: o.Keta3 || "",
        ุงูููุฏุณุฉ: o.Handsa || "",
        "ุณุจุจ ุงูุฑูุน": o.Removingfor || "",
        "ุชุงุฑูุฎ ุงูุฑูุน": formatDate(o.Uploaddate),
        "ุชูุฑูุฑ ูุญุต ุงูููุฏุณุฉ": o.Mremovingfor || "",
        "ุชุงุฑูุฎ ุฏุฎูู ุงูุตูุงูุฉ": formatDate(o.Enter_Maint_Date),
        ููุงุญุธุงุช: o.Notes || "",
        "ุญุงูุฉ ุงูุนุฏุงุฏ": o.MeterStatus || "",
      }));

      const ws = XLSX.utils.json_to_sheet(data);
      const wb = XLSX.utils.book_new();
      XLSX.utils.book_append_sheet(wb, ws, "Report");
      XLSX.writeFile(wb, "ุชูุฑูุฑ_ุฏุฎูู_ุงููุญุต.xlsx");
    }

    document.addEventListener("DOMContentLoaded", () => {
      fetchAllData();

      // Apply filter on text input
      searchInput.addEventListener("input", applyFilters);

      // Apply filter on year input
      year.addEventListener("input", applyFilters);

      // Apply filter on the dropdown selects
      [
        mtype,
        mconn,
        keta3,
        handsa,
        removingfor,
        mremovingfor,
        startDate,
        endDate,
      ].forEach((el) => {
        el.addEventListener("change", applyFilters); // Ensure "change" event is properly linked
      });

      exportBtn.addEventListener("click", exportToExcel);
      clearBtn.addEventListener("click", clearFilters);

      scrollUpBtn.onclick = () =>
        window.scrollTo({ top: 0, behavior: "smooth" });

      scrollDownBtn.onclick = () =>
        window.scrollTo({
          top: document.body.scrollHeight,
          behavior: "smooth",
        });
    });

    /* ================= SCROLL FUNCTIONS ================= */
    function scrollUp() {
      window.scrollTo({
        top: 0,
        behavior: "smooth",
      });
    }

    function scrollDown() {
      window.scrollTo({
        top: document.body.scrollHeight,
        behavior: "smooth",
      });
    }

    // ุฑุจุท ุงูุฃุฒุฑุงุฑ ุจุงูุฏูุงู
    document.querySelectorAll("#scrollUp").forEach((btn) => {
      btn.addEventListener("click", scrollUp);
    });

    document.querySelectorAll("#scrollDown").forEach((btn) => {
      btn.addEventListener("click", scrollDown);
    });

    // Dropdown Menu Functionality
    const btn = document.getElementById("dropdownBtn");
    const menu = document.getElementById("dropdownMenu");

    btn.addEventListener("click", () => {
      menu.style.display = menu.style.display === "block" ? "none" : "block";
    });

    document.querySelectorAll(".dropdown-item[data-page]").forEach((item) => {
      item.addEventListener("click", () => {
        const page = item.dataset.page;
        window.open(page, "_blank"); // ูุชุญ ูู ุชุจููุจ ุฌุฏูุฏ
      });
    });

    // ุฅุบูุงู ุนูุฏ ุงูุถุบุท ุฎุงุฑุฌ ุงููุงุฆูุฉ
    document.addEventListener("click", (e) => {
      if (!e.target.closest(".modern-dropdown")) {
        menu.style.display = "none";
      }
    });
  </script>
</body>

</html>