<!DOCTYPE html>
<html lang="ar" dir="rtl">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ุฏุฎูู ุนุฏุงุฏ โ ุงููุนูู ุงูููุฏุณู</title>

    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="G1_Calib.css">

    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script type="module" src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.esm.js"></script>
</head>

<body>
    <main class="app">

        <!-- RIGHT SIDE: TABLE -->
        <div class="right-side">
            <section class="table-top-section">
                <div class="table-header">
                    <ion-icon name="list-outline"></ion-icon>


                    <div class="modern-dropdown">
                        <button class="dropdown-btn" id="dropdownBtn">
                            โพ ุงุฎุชุฑ ุงูุตูุญุฉ ููุงูุชูุงู
                        </button>

                        <div class="dropdown-menu" id="dropdownMenu">
                            <div class="dropdown-group" data-icon="๐">ุงููุญุต</div>
                            <div class="dropdown-item" data-page="Entr_Calib.html">ุฏุฎูู ูุญุต ุนุฏุงุฏ</div>
                            <div class="dropdown-item" data-page="Calib.html">ูุญุต ุนุฏุงุฏ</div>
                            <div class="dropdown-item" data-page="Edite_Calib.html">ุชุนุฏูู ุจูุงูุงุช ูุญุต ุนุฏุงุฏ</div>
                            <div class="dropdown-item" data-page="Print_Out_Calib.html">ุทุจุงุนุฉ ุชูุฑูุฑ ูุญุต ุนุฏุงุฏ</div>
                            <div class="dropdown-item" data-page="Recived_Calib.html">ุชุณููู ุนุฏุงุฏ</div>

                            <div class="dropdown-group" data-icon="๐">ุชูุงุฑูุฑ ุงููุญุต</div>
                            <div class="dropdown-item" data-page="R_Entr_Calib.html">ุชูุฑูุฑ ุฏุฎูู ูุญุต ุนุฏุงุฏ</div>
                            <div class="dropdown-item" data-page="R_Calib.html">ุชูุฑูุฑ ูุญุต ุนุฏุงุฏ</div>

                            <div class="dropdown-group" data-icon="๐๏ธ">ุงูุตูุงูุฉ</div>
                            <div class="dropdown-item" data-page="Entr_Maint.html">ุฏุฎูู ุตูุงูุฉ ุนุฏุงุฏ</div>
                            <div class="dropdown-item" data-page="Maint.html">ุตูุงูุฉ ุนุฏุงุฏ</div>
                            <div class="dropdown-item" data-page="Edite_Maint.html">ุชุนุฏูู ุจูุงูุงุช ุตูุงูุฉ ุนุฏุงุฏ</div>
                            <div class="dropdown-item" data-page="Print_Out_SMaint.html">ุทุจุงุนุฉ ุชูุฑูุฑ ูุญุต ุตูุงูุฉ ุนุฏุงุฏ
                            </div>
                            <div class="dropdown-item" data-page="Print_Out_TMaint.html">ุทุจุงุนุฉ ุชูุฑูุฑ ูุฌูุน ุตูุงูุฉ ุนุฏุงุฏ
                            </div>

                            <div class="dropdown-group" data-icon="๐">ุชูุงุฑูุฑ ุงูุตูุงูุฉ</div>
                            <div class="dropdown-item" data-page="R_Entr_Maint.html">ุชูุฑูุฑ ุฏุฎูู ุตูุงูุฉ ุนุฏุงุฏ</div>
                            <div class="dropdown-item" data-page="R_Maint.html">ุชูุฑูุฑ ุตูุงูุฉ ุนุฏุงุฏ</div>

                            <div class="dropdown-group" data-icon="โป๏ธ">ุงูุชูููู</div>
                            <div class="dropdown-item" data-page="Takheen.html">ุชูููู ุนุฏุงุฏ</div>
                            <div class="dropdown-item" data-page="Edite_Takheen.html">ุชุนุฏูู ุจูุงูุงุช ุชูููู ุนุฏุงุฏ</div>
                            <div class="dropdown-item" data-page="R_Takheen.html">ุชูุฑูุฑ ุชูููู ุนุฏุงุฏ</div>

                            <div class="dropdown-group" data-icon="๐๏ธ">ุงูุฃุฑุดูู</div>
                            <div class="dropdown-item" data-page="R_Calib_Archive.html">ุฃุฑุดูู ุงููุญุต</div>
                            <div class="dropdown-item" data-page="R_Maint_Archive.html">ุฃุฑุดูู ุงูุตูุงูุฉ</div>
                            <div class="dropdown-item" data-page="Re_Print_Out_Calib.html">ุฅุนุงุฏุฉ ุทุจุงุนุฉ ุชูุฑูุฑ ูุญุต ุนุฏุงุฏ
                            </div>
                            <div class="dropdown-item" data-page="Re_Print_Out_SMaint.html">ุฅุนุงุฏุฉ ุทุจุงุนุฉ ุชูุฑูุฑ ูุญุต ุตูุงูุฉ
                                ุนุฏุงุฏ</div>
                            <div class="dropdown-item" data-page="Re_Print_Out_TMaint.html">ุฅุนุงุฏุฉ ุทุจุงุนุฉ ุชูุฑูุฑ ูุฌูุน ุตูุงูุฉ
                                ุนุฏุงุฏ</div>

                            <div class="dropdown-item" data-page="Main_Dashboard.html" data-icon="๐">ุงูุตูุญุฉ ุงูุฑุฆูุณูุฉ
                            </div>
                        </div>
                    </div>


                    <input type="date" class="calib_date" id="enter_calib_date" readonly>
                <div class="table-header-controls">
                    <input id="searchInput" placeholder="๐ ุจุญุซ...">
                    <button id="exportBtn">
                        <ion-icon name="download-outline"></ion-icon> ุชุตุฏูุฑ Excel
                    </button>
                </div>
                </div>
            </section>

            <section class="table-wrapper">
                <div class="table-container">
                    <table id="dataTable">
                        <thead>
                            <tr>
                                <th>ู</th>
                                <th>ููุน ุงููุธุงู</th>
                                <th>ุฑูู ุงูุนุฏุงุฏ</th>
                                <th>ููุฏ ุงููุดุชุฑู</th>
                                <th>ุงุณู ุงููุดุชุฑู</th>
                                <th>ููุน ุงูุนุฏุงุฏ</th>
                                <th>ููุน ุงูุชูุตูู</th>
                                <th>ุงูุฌูุฏ</th>
                                <th>ุฑูู ุงูุญุณุงุจ</th>
                                <th>ููุงู ุงูุชุฑููุจ</th>
                                <th>ุณูุฉ ุงูุตูุน</th>
                                <th>ุงููุฑุงุกุฉ</th>
                                <th>ุงููุฏุฑุฉ</th>
                                <th>ุงููุทุงุน</th>
                                <th>ุงูููุฏุณุฉ</th>
                                <th>ููุน ุงููุดุงุท</th>
                                <th>ุณุจุจ ุงูุฑูุน</th>
                                <th>ุชุงุฑูุฎ ุงูุฑูุน</th>
                                <th>ุชูุฑูุฑ ูุญุต ุงูููุฏุณุฉ</th>
                                <th>ููุงุญุธุงุช</th>
                                <th>ุญุงูุฉ ุงูุนุฏุงุฏ</th>
                            </tr>
                        </thead>
                        <tbody id="tableBody"></tbody>
                    </table>
                </div>
            </section>

            <div class="row-counter-dashboard" id="rowCount">
                <div class="dashboard-card">
                    <h3>ุนุฏุฏ ุงูุณุฌูุงุช</h3>
                    <span id="rowCountValue">0</span>
                </div>
            </div>

            <div class="scroll-buttons">
                <button id="scrollUp" class="scroll-btn" title="ุฅูู ุงูุฃุนูู">
                    <ion-icon name="chevron-up-outline"></ion-icon>
                </button>
                <button id="scrollDown" class="scroll-btn" title="ุฅูู ุงูุฃุณูู">
                    <ion-icon name="chevron-down-outline"></ion-icon>
                </button>
            </div>
        </div>

        <!-- LEFT SIDE: FORM -->
        <div class="left-side">
            <section class="glass">
                <div class="header-top">
                    <div class="logo">
                        <ion-icon name="flash-outline"></ion-icon>
                    </div>
                    <div class="header-text">
                        ูุฒุงุฑุฉ ุงูููุฑุจุงุก ูุงูุทุงูุฉ ุงููุชุฌุฏุฏุฉ<br>
                        ุงูุดุฑูุฉ ุงููุงุจุถุฉ ูููุฑุจุงุก ูุตุฑ<br>
                        ุดุฑูุฉ ุดูุงู ุงูุฏูุชุง ูุชูุฒูุน ุงูููุฑุจุงุก
                    </div>
                </div>

                <h1 class="title-main">ุงูุฅุฏุงุฑุฉ ุงูุนุงูุฉ ูุฃูุธูุฉ ุงูุนุฏุงุฏุงุช ุงูุญุฏูุซุฉ</h1>

                <h3>ุจูุงูุงุช ุฏุฎูู ุงูุนุฏุงุฏุงุช ุงููุณุฌูุฉ ูููุญุต</h3>

                <div class="form-grid">
                    <!-- Add your input/select fields here -->
                    <select id="types" aria-label="ููุน ุงููุธุงู">
                        <option value="">ููุน ุงููุธุงู</option>
                        <option>ุงูุฅุตุฏุงุฑ</option>
                        <option>ูุณุจู ุงูุฏูุน</option>
                        <option>ุงูุนุฏุงุฏุงุช ุงูุฐููุฉ</option>
                    </select>

                    <input id="mno" placeholder="ุฑูู ุงูุนุฏุงุฏ">
                    <input id="mco" placeholder="ููุฏ ุงููุดุชุฑู">
                    <input id="mname" placeholder="ุงุณู ุงููุดุชุฑู">
                    <input id="voltage" placeholder="ุงูุฌูุฏ">
                    <input id="accno" placeholder="ุฑูู ุงูุญุณุงุจ">
                    <input id="place" placeholder="ููุงู ุงูุชุฑููุจ">
                    <input id="year" placeholder="ุณูุฉ ุงูุตูุน">
                    <input id="mpower" placeholder="ุงููุฏุฑุฉ">
                    <label for="uploaddate">ุชุงุฑูุฎ ุงูุฑูุน</label>
                    <input type="date" class="calibdate" id="uploaddate" placeholder="ุชุงุฑูุฎ ุงูุฑูุน">

                    <select id="mtype" aria-label="ููุน ุงูุนุฏุงุฏ">
                        <option value="">โพ ุงุฎุชุฑ ููุน ุงูุนุฏุงุฏ</option>
                        <option>ุฌููุจุงู-ูุณุจู</option>
                        <option>ุณููุฏู-ูุณุจู</option>
                        <option>ุงููุตุฑูุฉ-ูุณุจู</option>
                        <option>ุงุณูุฑุง-ูุณุจู</option>
                        <option>ุฌูุฒุฉ ุจุงูุฑ-ูุณุจู</option>
                        <option>ูููุงูููู</option>
                        <option>ุฑููู</option>
                        <option>ุนุฏุงุฏุงุช-ุฐููุฉ</option>
                        <option>ุฃุฎุฑู</option>
                    </select>

                    <select id="mconn" aria-label="ููุน ุงูุชูุตูู">
                        <option value="">ููุน ุงูุชูุตูู</option>
                        <option>ุฃุญุงุฏู</option>
                        <option>ุซูุงุซู-ูุจุงุดุฑ</option>
                        <option>ุซูุงุซู-ุบูุฑ ูุจุงุดุฑ</option>
                    </select>

                    <select id="keta3" aria-label="ุงููุทุงุน">
                        <option value="">ุงููุทุงุน</option>
                        <option>ุฏููุงุท</option>
                        <option>ุดูุงู-ุงูุฏููููุฉ</option>
                        <option>ุฌููุจ-ุงูุฏููููุฉ</option>
                        <option>ููุฑ ุงูุดูุฎ</option>
                    </select>

                    <select id="handsa" aria-label="ุงูููุฏุณุฉ">
                        <option value="">ุงูููุฏุณุฉ</option>
                        <option>ููุฏุณุฉ ุดูุงู ุฏููุงุท</option>
                        <option>ููุฏุณุฉ ุฌููุจ ุฏููุงุท</option>
                        <option>ููุฏุณุฉ ุนุฒุจุฉ ุงูุจุฑุฌ</option>
                        <option>ููุฏุณุฉ ููุฑ ุณุนุฏ</option>
                        <option>ููุฏุณุฉ ููุฑ ุงูุจุทูุฎ</option>
                        <option>ููุฏุณุฉ ุฑุงุณ ุงูุจุฑ</option>
                        <option>ููุฏุณุฉ ุฏููุงุท ุงูุฌุฏูุฏุฉ</option>
                        <option>ููุฏุณุฉ ุงูุฒุฑูุง</option>
                        <option>ููุฏุณุฉ ูุงุฑุณููุฑ</option>
                        <option>ููุฏุณุฉ ุงูุฑูุถุฉ</option>
                        <option>ููุฏุณุฉ ุงูุดุนุฑุงุก</option>
                        <option>ููุฏุณุฉ ูุฏููุฉ ุดุฑุจูู</option>
                        <option>ููุฏุณุฉ ูุฑู ุดุฑุจูู</option>
                        <option>ููุฏุณุฉ ุฏูุฑูุณ</option>
                        <option>ููุฏุณุฉ ุฌูุตุฉ</option>
                        <option>ููุฏุณุฉ ูุฑู ุจููุงุณ</option>
                        <option>ููุฏุณุฉ ูุฏููุฉ ุจููุงุณ</option>
                        <option>ููุฏุณุฉ ุงูุณุชุงูููู</option>
                        <option>ููุฏุณุฉ ุจูู ุนุจูุฏ</option>
                        <option>ููุฏุณุฉ ูููุฉ ุงููุตุฑ</option>
                        <option>ููุฏุณุฉ ููุช ุณูุณูู</option>
                        <option>ููุฏุณุฉ ุงูุฌูุงููุฉ</option>
                        <option>ููุฏุณุฉ ูุฑู ุงูููุฒูุฉ</option>
                        <option>ููุฏุณุฉ ูุฏููุฉ ุงูููุฒูุฉ</option>
                        <option>ููุฏุณุฉ ุงููุทุฑูุฉ</option>
                        <option>ููุฏุณุฉ ุดุฑู ุงูููุตูุฑุฉ</option>
                        <option>ููุฏุณุฉ ุบุฑุจ ุงูููุตูุฑุฉ</option>
                        <option>ููุฏุณุฉ ุทูุฎุง</option>
                        <option>ููุฏุณุฉ ูุจุฑูู</option>
                        <option>ููุฏุณุฉ ูุฑู ุงูููุตูุฑุฉ 1</option>
                        <option>ููุฏุณุฉ ูุฑู ุงูููุตูุฑุฉ 2</option>
                        <option>ููุฏุณุฉ ุงุฌุง</option>
                        <option>ููุฏุณุฉ ูุฏููุฉ ุงูุณูุจูุงููู</option>
                        <option>ููุฏุณุฉ ูุฑู ุงูุณูุจูุงููู</option>
                        <option>ููุฏุณุฉ ุชูู ุงูุงูุฏูุฏ</option>
                        <option>ููุฏุณุฉ ูุฏููุฉ ููุช ุบูุฑ</option>
                        <option>ููุฏุณุฉ ูุฑู ููุช ุบูุฑ</option>
                        <option>ููุฏุณุฉ ููู ุงูููุฑ</option>
                        <option>ููุฏุณุฉ ูุฏููุฉ ููุฑ ุงูุดูุฎ</option>
                        <option>ููุฏุณุฉ ุบุฑุจ ููุฑ ุงูุดูุฎ</option>
                        <option>ููุฏุณุฉ ุดุฑู ููุฑ ุงูุดูุฎ</option>
                        <option>ููุฏุณุฉ ูููู</option>
                        <option>ููุฏุณุฉ ูุฑู ุณูุฏู ุณุงูู</option>
                        <option>ููุฏุณุฉ ูุฏููุฉ ุณูุฏู ุณุงูู</option>
                        <option>ููุฏุณุฉ ุงูุฑูุงุถ</option>
                        <option>ููุฏุณุฉ ูุฏููุฉ ุฏุณูู</option>
                        <option>ููุฏุณุฉ ูุฑู ุดูุงู ุฏุณูู</option>
                        <option>ููุฏุณุฉ ูุฑู ุฌููุจ ุฏุณูู</option>
                        <option>ููุฏุณุฉ ููู</option>
                        <option>ููุฏุณุฉ ูุทูุจุณ</option>
                        <option>ููุฏุณุฉ ูุฏููุฉ ุงูุญุงููู</option>
                        <option>ููุฏุณุฉ ูุฑู ุงูุญุงููู</option>
                        <option>ููุฏุณุฉ ุจููุง</option>
                        <option>ููุฏุณุฉ ุจูุทูู</option>
                        <option>ููุฏุณุฉ ุจุฑุฌ ุงูุจุฑูุณ</option>
                    </select>

                    <select id="nashattype" aria-label="ููุน ุงููุดุงุท">
                        <option value="">ููุน ุงููุดุงุท</option>
                        <option>ููุฒูู</option>
                        <option>ุชุฌุงุฑู</option>
                        <option>ูุญุฑู</option>
                        <option>ุฑู</option>
                        <option>ุงุณุชุซูุงุฑ ุตูุงุนุฉ</option>
                        <option>ูุจุงุฑ</option>
                        <option>ูุตุงูุญ ุญููููุฉ</option>
                    </select>

                    <select id="removingfor" aria-label="ุณุจุจ ุงูุฑูุน">
                        <option value="">ุณุจุจ ุงูุฑูุน</option>
                        <option>ุงููุญุต</option>
                        <option>ุงูุตูุงูุฉ</option>
                        <option>ุงููุฏู ูุงูุจูุงุก</option>
                        <option>ุชุตููุฉ ูุดุชุฑู</option>
                        <option>ุฒูุงุฏุฉ ูุฏุฑุฉ</option>
                        <option>ุงุญูุงู ุฑุจุงุนู</option>
                        <option>ุชูุงุฒู</option>
                        <option>ุฎุทุฉ ุงุญูุงู</option>
                        <option>ุงุญูุงู ุนุฏู ุณุฏุงุฏ</option>
                    </select>

                    <select id="mremovingfor" aria-label="ุชูุฑูุฑ ูุญุต ุงูููุฏุณุฉ">
                        <option value="">ุชูุฑูุฑ ูุญุต ุงูููุฏุณุฉ</option>
                        <option>ุนุทู ุจุงูุจุทุงุฑูุฉ ุงุฑุณุงูุฉ ููุดุฑูุฉ ุงูููุฑุฏุฉ ููุตูุงูุฉ</option>
                        <option>ูุงุฑูุก ุงููุฑูุช ูุง ูุนูู ุงุฑุณุงูุฉ ููุดุฑูุฉ ุงูููุฑุฏุฉ ููุตูุงูุฉ</option>
                        <option>ุงูุนุฏุงุฏ ูุง ููุจู ุงูุดุญู ุงุฑุณุงูุฉ ููุดุฑูุฉ ุงูููุฑุฏุฉ ููุตูุงูุฉ</option>
                        <option>ุงูุนุฏุงุฏ ูุง ูููู ุจุงูุชูุตูู ุงุฑุณุงูุฉ ููุดุฑูุฉ ุงูููุฑุฏุฉ ููุตูุงูุฉ</option>
                        <option>ุงูุดุงุดุฉ ุนุงุทูุฉ ุงุฑุณุงูุฉ ููุดุฑูุฉ ุงูููุฑุฏุฉ ููุตูุงูุฉ</option>
                        <option>ุงูุนุฏุงุฏ ูุญุชุงุฌ ููุชููุฆุฉ ุงุฑุณุงูุฉ ููุดุฑูุฉ ุงูููุฑุฏุฉ ููุตูุงูุฉ</option>
                        <option>ุชูุฑูุฑ ูุญุต ููุนุฏุงุฏ ูู ูุจู ุงูุดุฑูุฉ ุงูููุฑุฏุฉ</option>
                        <option>ุชูู ุจุฌุณู/ุฑูุฒุชุฉ ุงูุนุฏุงุฏ ุงุฑุณุงูุฉ ููุดุฑูุฉ ุงูููุฑุฏุฉ ููุตูุงูุฉ</option>
                        <option>ุฒูุงุฏุฉ ูุฏุฑุฉ ุงุฑุณุงูุฉ ููุดุฑูุฉ ุงูููุฑุฏุฉ ููุตูุงูุฉ</option>
                        <option>ุจุญุซ ูุฏููููุฉ ุจุงูุนุฏุงุฏ ุงุฑุณุงูุฉ ููุดุฑูุฉ ุงูููุฑุฏุฉ ููุตูุงูุฉ</option>
                        <option>ุงูุนุฏุงุฏ ูุญุชุฑู ุงุฑุณุงูุฉ ููุดุฑูุฉ ุงูููุฑุฏุฉ ููุตูุงูุฉ</option>
                        <option>ุงูุนุฏุงุฏ ูุง ูุนูู ุงุฑุณุงูุฉ ููุดุฑูุฉ ุงูููุฑุฏุฉ ููุตูุงูุฉ</option>
                        <option>ููุจุฉ ุงูุชูุงุนุจ ุชุนูู ุจุงุณุชูุฑุงุฑ ุงุฑุณุงูุฉ ููุดุฑูุฉ ุงูููุฑุฏุฉ ููุตูุงูุฉ</option>
                        <option>ุงูุนุฏุงุฏ ูุนูู ุจุฏูู ุดุญู ุงุฑุณุงูุฉ ููุดุฑูุฉ ุงูููุฑุฏุฉ ููุตูุงูุฉ</option>
                        <option>ุงูุนุฏุงุฏ ูุง ูุณุฌู ุงูุงุณุชููุงู ุงุฑุณุงูุฉ ููุดุฑูุฉ ุงูููุฑุฏุฉ ููุตูุงูุฉ</option>
                        <option>ุงูุนุฏุงุฏ ูุณุฌู ุงุณุชููุงู ุจุฏูู ุญูู ุงุฑุณุงูุฉ ููุดุฑูุฉ ุงูููุฑุฏุฉ ููุตูุงูุฉ</option>
                        <option>blocking</option>
                    </select>

                    <textarea id="notes" placeholder="ููุงุญุธุงุช"></textarea>
                </div>

                <div class="buttons">
                    <button id="saveBtn" class="primary">ุญูุธ</button>
                    <button id="editBtn" class="warning">ุชุนุฏูู</button>
                    <button id="clearBtn" class="secondary">ุชูุฑูุบ</button>
                    <button id="deleteBtn" class="danger">ุญุฐู</button>
                </div>

            </section>
        </div>

    </main>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.3.1/firebase-app.js";
        import { getDatabase, ref, get, set, push, update, remove } from "https://www.gstatic.com/firebasejs/10.3.1/firebase-database.js";

        // Initialize Firebase app
        const app = initializeApp({
            apiKey: "AIzaSyCTSWDR3IvFpzp8UARsClrpwbRtTwr12jA",
            authDomain: "ndedc-meter-calib.firebaseapp.com",
            databaseURL: "https://ndedc-meter-calib-default-rtdb.firebaseio.com",
            projectId: "ndedc-meter-calib",
            storageBucket: "ndedc-meter-calib.appspot.com",
            messagingSenderId: "185425429190",
            appId: "1:185425429190:web:dce85f29eea55ad9f54dc7",
            measurementId: "G-C6QEKW26MW"
        });

        const db = getDatabase(app);
        const el = id => document.getElementById(id);
        let currentKey = null;

        // Set today's date in the upload date field
        el("uploaddate").value = new Date().toISOString().split('T')[0];
        el("enter_calib_date").value = new Date().toISOString().split('T')[0];

        // Function to format date
        function formatDate(dateStr) {
            const date = new Date(dateStr);
            const day = String(date.getDate()).padStart(2, '0');
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const Year = date.getFullYear();
            return `${day}/${month}/${Year}`;
        }

        // Fetch data from Firebase and display it in the table
        async function fetchData(q = "") {
            const tbody = el("tableBody");
            tbody.innerHTML = "";
            const snap = await get(ref(db, "Enter_Calib"));
            let i = 1;
            const query = q.toLowerCase();

            if (!snap.exists()) {
                updateRowCount();
                return;
            }

            snap.forEach(c => {
                const d = c.val().otherdata || c.val();
                if (q && !d.MNO?.toLowerCase().includes(query) && !d.MNAME?.toLowerCase().includes(query)) return;

                const tr = document.createElement("tr");
                tr.innerHTML = `

                <td>${i++}</td>
                <td>${d.Type || ''}</td>
                <td>${d.MNO || ''}</td>
                <td>${d.MCO || ''}</td>
                <td>${d.MNAME || ''}</td>
                <td>${d.Mtype || ''}</td>
                <td>${d.Connection || ''}</td>
                <td>${d.Voltage || ''}</td>
                <td>${d.ACCNO || ''}</td>
                <td>${d.PLACE || ''}</td>
                <td>${d.YEAR || ''}</td>
                <td>${d.MREADING || ''}</td>
                <td>${d.MPOWER || ''}</td>
                <td>${d.Keta3 || ''}</td>
                <td>${d.Handsa || ''}</td>
                <td>${d.Nashattype || ''}</td>
                <td>${d.Removingfor || ''}</td>
                <td>${formatDate(d.Uploaddate)}</td>
                <td>${d.Mremovingfor || ''}</td>
                <td>${d.Notes || ''}</td>
                <td><span class="status">ููุฏ ุงููุญุต</span></td>

            `;
                tr.onclick = () => fillForm(d, c.key, tr);
                tbody.appendChild(tr);
            });

            updateRowCount();
        }

        // Fill form with selected row's data
        function fillForm(d, key, row) {
            currentKey = key;

            document.querySelectorAll(".selected-row")
                .forEach(r => r.classList.remove("selected-row"));
            row.classList.add("selected-row");

            el("mno").value = d.MNO || "";
            el("mname").value = d.MNAME || "";
            el("mco").value = d.MCO || "";
            el("accno").value = d.ACCNO || "";   // โ ูุฐุง ูู ุงูููู
            el("voltage").value = d.Voltage || "";
            el("place").value = d.PLACE || "";
            el("year").value = d.YEAR || "";
            el("mpower").value = d.MPOWER || "";

            el("types").value = d.Type || "";
            el("mtype").value = d.Mtype || "";
            el("mconn").value = d.Connection || "";
            el("keta3").value = d.Keta3 || "";
            el("handsa").value = d.Handsa || "";
            el("nashattype").value = d.Nashattype || "";
            el("removingfor").value = d.Removingfor || "";
            el("mremovingfor").value = d.Mremovingfor || "";

            el("uploaddate").value = d.Uploaddate || "";
            el("notes").value = d.Notes || "";
        }


        // Save button: always create a new entry
        async function saveData() {
            const data = {
                MNO: el("mno").value,
                MNAME: el("mname").value,
                MCO: el("mco").value,
                Voltage: el("voltage").value,
                ACCNO: el("accno").value,
                PLACE: el("place").value,
                YEAR: el("year").value,
                MPOWER: el("mpower").value,
                Type: el("types").value,
                Mtype: el("mtype").value,
                Connection: el("mconn").value,
                Keta3: el("keta3").value,
                Handsa: el("handsa").value,
                Nashattype: el("nashattype").value,
                Removingfor: el("removingfor").value,
                Mremovingfor: el("mremovingfor").value,
                Uploaddate: el("uploaddate").value,  // keep date selected in form
                Enter_Calib_Date: el("enter_calib_date").value,
                Notes: el("notes").value,
            };

            await set(push(ref(db, "Enter_Calib")), { otherdata: data });
            await set(push(ref(db, "Archive_Enter_Calib")), { otherdata: data });
            Swal.fire('ุชู ุงูุญูุธ!', 'ุชู ุฅุถุงูุฉ ุงูุนุฏุงุฏ ุจูุฌุงุญ.', 'success');

            fetchData();
            clearForm();
        }

        // Edit button: update existing entry and update the Uploaddate to today
        async function editData() {
            if (!currentKey) return Swal.fire('ุฎุทุฃ', 'ุงุฎุชุฑ ุนุฏุงุฏ ูุชุนุฏููู', 'error');

            const data = {
                MNO: el("mno").value,
                MNAME: el("mname").value,
                MCO: el("mco").value,
                Voltage: el("voltage").value,
                ACCNO: el("accno").value,
                PLACE: el("place").value,
                YEAR: el("year").value,
                MPOWER: el("mpower").value,
                Type: el("types").value,
                Mtype: el("mtype").value,
                Connection: el("mconn").value,
                Keta3: el("keta3").value,
                Handsa: el("handsa").value,
                Nashattype: el("nashattype").value,
                Removingfor: el("removingfor").value,
                Mremovingfor: el("mremovingfor").value,
                Uploaddate: el("uploaddate").value,
                Notes: el("notes").value,
                Enter_Calib_Date: el("enter_calib_date").value,
            };

            await update(ref(db, `Enter_Calib/${currentKey}/otherdata`), data);
            await update(ref(db, `Archive_Enter_Calib/${currentKey}/otherdata`), data);
            Swal.fire('ุชู ุงูุชุญุฏูุซ!', 'ุชู ุชุนุฏูู ุจูุงูุงุช ุงูุนุฏุงุฏ ุจูุฌุงุญ.', 'success');

            fetchData();
            clearForm();
        }

        // Clear form fields
        function clearForm() {
            currentKey = null;
            document.querySelectorAll(".left-side input, .left-side select, .left-side textarea")
                .forEach(e => e.value = "");

            el("uploaddate").value = new Date().toISOString().split('T')[0];
        }


        // Delete button: remove selected entry
        async function deleteData() {
            if (!currentKey) return Swal.fire('ุฎุทุฃ', 'ุงุฎุชุฑ ุนุฏุงุฏ ููุญุฐู', 'error');
            await remove(ref(db, "Enter_Calib/" + currentKey));
            clearForm();
            fetchData();
        }

        // Update row count in the table
        function updateRowCount() {
            const rows = document.querySelectorAll("#tableBody tr");
            el("rowCountValue").textContent = rows.length; // Update the count dynamically
        }

        // Event listeners
        el("saveBtn").onclick = saveData;
        el("editBtn").onclick = editData;
        el("clearBtn").onclick = clearForm;
        el("deleteBtn").onclick = deleteData;
        el("exportBtn").onclick = exportToExcel;
        el("searchInput").oninput = e => fetchData(e.target.value);

        // Scroll buttons
        el("scrollUp").onclick = () => window.scrollTo({ top: 0, behavior: 'smooth' });
        el("scrollDown").onclick = () => window.scrollTo({ top: document.body.scrollHeight, behavior: 'smooth' });

        // Initial fetch
        fetchData();


        function exportToExcel() {
            try {
                const table = document.getElementById('dataTable');
                const ws = XLSX.utils.table_to_sheet(table);
                const wb = XLSX.utils.book_new();
                XLSX.utils.book_append_sheet(wb, ws, "ุจูุงูุงุช ุชุณุฌูู ุฏุฎูู ุงููุญุต");

                const filename = `XLSX.utils.book_append_sheet(wb, ws, "ุจูุงูุงุช ุชุณุฌูู ุฏุฎูู ุงููุญุต");${new Date().toISOString().split('T')[0]}.xlsx`;
                XLSX.writeFile(wb, filename);
                showNotification('ุชู ุชุตุฏูุฑ ุงูุจูุงูุงุช ุฅูู Excel ุจูุฌุงุญ', 'success');
            } catch (error) {
                console.error('Error exporting:', error);
                showNotification('ุญุฏุซ ุฎุทุฃ ุฃุซูุงุก ุงูุชุตุฏูุฑ', 'error');
            }
        }

        /* ================= SCROLL FUNCTIONS ================= */
        function scrollUp() {
            window.scrollTo({
                top: 0,
                behavior: "smooth"
            });
        }

        function scrollDown() {
            window.scrollTo({
                top: document.body.scrollHeight,
                behavior: "smooth"
            });
        }
        // ุฑุจุท ุงูุฃุฒุฑุงุฑ ุจุงูุฏูุงู
        document.querySelectorAll("#scrollUp").forEach(btn => {
            btn.addEventListener("click", scrollUp);
        });

        document.querySelectorAll("#scrollDown").forEach(btn => {
            btn.addEventListener("click", scrollDown);
        });



        // Dropdown Menu Functionality
        const btn = document.getElementById("dropdownBtn");
        const menu = document.getElementById("dropdownMenu");

        btn.addEventListener("click", () => {
            menu.style.display = menu.style.display === "block" ? "none" : "block";
        });

        document.querySelectorAll('.dropdown-item[data-page]').forEach(item => {
            item.addEventListener('click', () => {
                const page = item.dataset.page;
                window.open(page, '_blank'); // ูุชุญ ูู ุชุจููุจ ุฌุฏูุฏ
            });
        });

        // ุฅุบูุงู ุนูุฏ ุงูุถุบุท ุฎุงุฑุฌ ุงููุงุฆูุฉ
        document.addEventListener("click", e => {
            if (!e.target.closest(".modern-dropdown")) {
                menu.style.display = "none";
            }
        });



    </script>
</body>

</html>
