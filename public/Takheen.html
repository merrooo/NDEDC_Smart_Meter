  <html lang="ar" dir="rtl">

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>ูุธุงู ุงูุชูููู - ูุญุต ุงูุนุฏุงุฏุงุช ุงูููุฑุจุงุฆูุฉ</title>

    <link rel="stylesheet" href="G1_Calib.css" />
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600&display=swap" rel="stylesheet" />

    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script type="module" src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.esm.js"></script>
  </head>

  <body>
    <main class="app">
      <!-- ================= RIGHT SIDE ================= -->
      <div class="right-side">
        <section class="table-top-section">
          <div class="table-header">
            <ion-icon name="list-outline"></ion-icon>

            <div class="modern-dropdown">
              <button class="dropdown-btn" id="dropdownBtn">
                โพ ุงุฎุชุฑ ุงูุตูุญุฉ ููุงูุชูุงู
              </button>

              <div class="dropdown-menu" id="dropdownMenu">
                <div class="dropdown-group" data-icon="๐">ุงููุญุต</div>
                <div class="dropdown-item" data-page="Entr_Calib.html">
                  ุฏุฎูู ูุญุต ุนุฏุงุฏ
                </div>
                <div class="dropdown-item" data-page="Calib.html">ูุญุต ุนุฏุงุฏ</div>
                <div class="dropdown-item" data-page="Edite_Calib.html">
                  ุชุนุฏูู ุจูุงูุงุช ูุญุต ุนุฏุงุฏ
                </div>
                <div class="dropdown-item" data-page="Print_Out_Calib.html">
                  ุทุจุงุนุฉ ุชูุฑูุฑ ูุญุต ุนุฏุงุฏ
                </div>
                <div class="dropdown-item" data-page="Recived_Calib.html">
                  ุชุณููู ุนุฏุงุฏ
                </div>

                <div class="dropdown-group" data-icon="๐">ุชูุงุฑูุฑ ุงููุญุต</div>
                <div class="dropdown-item" data-page="R_Entr_Calib.html">
                  ุชูุฑูุฑ ุฏุฎูู ูุญุต ุนุฏุงุฏ
                </div>
                <div class="dropdown-item" data-page="R_Calib.html">
                  ุชูุฑูุฑ ูุญุต ุนุฏุงุฏ
                </div>

                <div class="dropdown-group" data-icon="๐๏ธ">ุงูุตูุงูุฉ</div>
                <div class="dropdown-item" data-page="Entr_Maint.html">
                  ุฏุฎูู ุตูุงูุฉ ุนุฏุงุฏ
                </div>
                <div class="dropdown-item" data-page="Maint.html">
                  ุตูุงูุฉ ุนุฏุงุฏ
                </div>
                <div class="dropdown-item" data-page="Edite_Maint.html">
                  ุชุนุฏูู ุจูุงูุงุช ุตูุงูุฉ ุนุฏุงุฏ
                </div>
                <div class="dropdown-item" data-page="Print_Out_SMaint.html">
                  ุทุจุงุนุฉ ุชูุฑูุฑ ูุญุต ุตูุงูุฉ ุนุฏุงุฏ
                </div>
                <div class="dropdown-item" data-page="Print_Out_TMaint.html">
                  ุทุจุงุนุฉ ุชูุฑูุฑ ูุฌูุน ุตูุงูุฉ ุนุฏุงุฏ
                </div>

                <div class="dropdown-group" data-icon="๐">ุชูุงุฑูุฑ ุงูุตูุงูุฉ</div>
                <div class="dropdown-item" data-page="R_Entr_Maint.html">
                  ุชูุฑูุฑ ุฏุฎูู ุตูุงูุฉ ุนุฏุงุฏ
                </div>
                <div class="dropdown-item" data-page="R_Maint.html">
                  ุชูุฑูุฑ ุตูุงูุฉ ุนุฏุงุฏ
                </div>

                <div class="dropdown-group" data-icon="โป๏ธ">ุงูุชูููู</div>
                <div class="dropdown-item" data-page="Takheen.html">
                  ุชูููู ุนุฏุงุฏ
                </div>
                <div class="dropdown-item" data-page="Edite_Takheen.html">
                  ุชุนุฏูู ุจูุงูุงุช ุชูููู ุนุฏุงุฏ
                </div>
                <div class="dropdown-item" data-page="R_Takheen.html">
                  ุชูุฑูุฑ ุชูููู ุนุฏุงุฏ
                </div>

                <div class="dropdown-group" data-icon="๐๏ธ">ุงูุฃุฑุดูู</div>
                <div class="dropdown-item" data-page="R_Calib_Archive.html">
                  ุฃุฑุดูู ุงููุญุต
                </div>
                <div class="dropdown-item" data-page="R_Maint_Archive.html">
                  ุฃุฑุดูู ุงูุตูุงูุฉ
                </div>
                <div class="dropdown-item" data-page="Re_Print_Out_Calib.html">
                  ุฅุนุงุฏุฉ ุทุจุงุนุฉ ุชูุฑูุฑ ูุญุต ุนุฏุงุฏ
                </div>
                <div class="dropdown-item" data-page="Re_Print_Out_SMaint.html">
                  ุฅุนุงุฏุฉ ุทุจุงุนุฉ ุชูุฑูุฑ ูุญุต ุตูุงูุฉ ุนุฏุงุฏ
                </div>
                <div class="dropdown-item" data-page="Re_Print_Out_TMaint.html">
                  ุฅุนุงุฏุฉ ุทุจุงุนุฉ ุชูุฑูุฑ ูุฌูุน ุตูุงูุฉ ุนุฏุงุฏ
                </div>

                <div class="dropdown-item" data-page="Main_Dashboard.html" data-icon="๐">
                  ุงูุตูุญุฉ ุงูุฑุฆูุณูุฉ
                </div>
              </div>
            </div>

            <input type="date" id="takheendate" class="calib_date" readonly />
            <div class="table-header-controls">
              <input id="searchInput" placeholder="๐ ุงุจุญุซ ูู ุฌููุน ุงูุญููู..." />
              <button id="exportBtn">
                <ion-icon name="download-outline"></ion-icon> ุชุตุฏูุฑ Excel
              </button>
            </div>
          </div>
        </section>

        <!-- Table Section -->
        <section class="table-wrapper">
          <div class="table-container">
            <table id="dataTable">
              <thead>
                <tr>
                  <th>ููุน ุงููุธุงู</th>
                  <th>ุฑูู ุงูุนุฏุงุฏ</th>
                  <th>ุงุณู ุงููุดุชุฑู</th>
                  <th>ููุน ุงูุนุฏุงุฏ</th>
                  <th>ููุน ุงูุชูุตูู</th>
                  <th>ุณูุฉ ุงูุตูุน</th>
                  <th>ุงููุทุงุน</th>
                  <th>ุงูููุฏุณุฉ</th>
                  <th>ุณุจุจ ุงูุฑูุน</th>
                  <th>ุชุงุฑูุฎ ุงูุฑูุน</th>
                  <th>ุชูุฑูุฑ ูุญุต ุงูููุฏุณุฉ</th>
                  <th>ุณุจุจ ุงูุชูููู</th>
                  <th>ุชุงุฑูุฎ ุงูุชูููู</th>
                  <th>ููุงุญุธุงุช</th>
                  <th>ุงูุญุงูุฉ</th>
                </tr>
              </thead>
              <tbody id="tableBody">
                <tr id="noDataRow">
                  <td colspan="11" class="no-data-cell">
                    <ion-icon name="document-outline"></ion-icon>
                    <p>ูุง ุชูุฌุฏ ุจูุงูุงุช ูุนุฑุถูุง</p>
                    <p>ุงุจุฏุฃ ุจุฅุถุงูุฉ ุจูุงูุงุช ุฌุฏูุฏุฉ</p>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </section>

        <div class="row-counter-dashboard">
          <div class="dashboard-card">
            <h3>ุนุฏุฏ ุงูุณุฌูุงุช</h3>
            <span id="rowCountValue">0</span>
          </div>
        </div>

        <div class="scroll-buttons">
          <button id="scrollUp" class="scroll-btn" title="ุฅูู ุงูุฃุนูู">
            <ion-icon name="chevron-up-outline"></ion-icon>
          </button>
          <button id="scrollDown" class="scroll-btn" title="ุฅูู ุงูุฃุณูู">
            <ion-icon name="chevron-down-outline"></ion-icon>
          </button>
        </div>
      </div>

      <!-- ================= LEFT SIDE ================= -->
      <div class="left-side">
        <section class="glass">
          <div class="header-top">
            <div class="logo"><ion-icon name="flash-outline"></ion-icon></div>
            <div class="header-text">
              ูุฒุงุฑุฉ ุงูููุฑุจุงุก ูุงูุทุงูุฉ ุงููุชุฌุฏุฏุฉ<br />
              ุงูุดุฑูุฉ ุงููุงุจุถุฉ ูููุฑุจุงุก ูุตุฑ<br />
              ุดุฑูุฉ ุดูุงู ุงูุฏูุชุง ูุชูุฒูุน ุงูููุฑุจุงุก
            </div>
          </div>

          <h1 class="title-main">ุงูุฅุฏุงุฑุฉ ุงูุนุงูุฉ ูุฃูุธูุฉ ุงูุนุฏุงุฏุงุช ุงูุญุฏูุซุฉ</h1>

          <h3>ุจูุงูุงุช ุนุฏุงุฏุงุช ุงูุชูููู</h3>

          <div class="form-grid">
            <select id="type" aria-label="ููุน ุงููุธุงู">
              <option value="">โพ ุงุฎุชุฑ ููุน ุงููุธุงู</option>
              <option>ุงูุฃุตุฏุงุฑ</option>
              <option>ูุณุจู ุงูุฏูุน</option>
              <option>ุงูุนุฏุงุฏุงุช ุงูุฐููุฉ</option>
            </select>

            <select id="mconn" aria-label="ููุน ุงูุชูุตูู">
              <option value="">โพููุน ุงูุชูุตูู</option>
              <option>ุฃุญุงุฏู</option>
              <option>ุซูุงุซู-ูุจุงุดุฑ</option>
              <option>ุซูุงุซู-ุบูุฑ ูุจุงุดุฑ</option>
            </select>

            <input id="year" placeholder="ุณูุฉ ุงูุตูุน" />

            <input id="mno" placeholder="ุฑูู ุงูุนุฏุงุฏ" />
            <input id="mname" placeholder="ุงุณู ุงููุดุชุฑู" />
            <select id="keta3" aria-label="ุงููุทุงุน">
              <option value="">โพ ุงููุทุงุน</option>
              <option>ุฏููุงุท</option>
              <option>ุดูุงู-ุงูุฏููููุฉ</option>
              <option>ุฌููุจ-ุงูุฏููููุฉ</option>
              <option>ููุฑ ุงูุดูุฎ</option>
            </select>

            <select id="handsa" aria-label="ุงูููุฏุณุฉ">
              <option value="">โพ ุงูููุฏุณุฉ</option>
              <option>ููุฏุณุฉ ุดูุงู ุฏููุงุท</option>
              <option>ููุฏุณุฉ ุฌููุจ ุฏููุงุท</option>
              <option>ููุฏุณุฉ ุนุฒุจุฉ ุงูุจุฑุฌ</option>
              <option>ููุฏุณุฉ ููุฑ ุณุนุฏ</option>
              <option>ููุฏุณุฉ ููุฑ ุงูุจุทูุฎ</option>
              <option>ููุฏุณุฉ ุฑุงุณ ุงูุจุฑ</option>
              <option>ููุฏุณุฉ ุฏููุงุท ุงูุฌุฏูุฏุฉ</option>
              <option>ููุฏุณุฉ ุงูุฒุฑูุง</option>
              <option>ููุฏุณุฉ ูุงุฑุณููุฑ</option>
              <option>ููุฏุณุฉ ุงูุฑูุถุฉ</option>
              <option>ููุฏุณุฉ ุงูุดุนุฑุงุก</option>
              <option>ููุฏุณุฉ ูุฏููุฉ ุดุฑุจูู</option>
              <option>ููุฏุณุฉ ูุฑู ุดุฑุจูู</option>
              <option>ููุฏุณุฉ ุฏูุฑูุณ</option>
              <option>ููุฏุณุฉ ุฌูุตุฉ</option>
              <option>ููุฏุณุฉ ูุฑู ุจููุงุณ</option>
              <option>ููุฏุณุฉ ูุฏููุฉ ุจููุงุณ</option>
              <option>ููุฏุณุฉ ุงูุณุชุงูููู</option>
              <option>ููุฏุณุฉ ุจูู ุนุจูุฏ</option>
              <option>ููุฏุณุฉ ูููุฉ ุงููุตุฑ</option>
              <option>ููุฏุณุฉ ููุช ุณูุณูู</option>
              <option>ููุฏุณุฉ ุงูุฌูุงููุฉ</option>
              <option>ููุฏุณุฉ ูุฑู ุงูููุฒูุฉ</option>
              <option>ููุฏุณุฉ ูุฏููุฉ ุงูููุฒูุฉ</option>
              <option>ููุฏุณุฉ ุงููุทุฑูุฉ</option>
              <option>ููุฏุณุฉ ุดุฑู ุงูููุตูุฑุฉ</option>
              <option>ููุฏุณุฉ ุบุฑุจ ุงูููุตูุฑุฉ</option>
              <option>ููุฏุณุฉ ุทูุฎุง</option>
              <option>ููุฏุณุฉ ูุจุฑูู</option>
              <option>ููุฏุณุฉ ูุฑู ุงูููุตูุฑุฉ 1</option>
              <option>ููุฏุณุฉ ูุฑู ุงูููุตูุฑุฉ 2</option>
              <option>ููุฏุณุฉ ุงุฌุง</option>
              <option>ููุฏุณุฉ ูุฏููุฉ ุงูุณูุจูุงููู</option>
              <option>ููุฏุณุฉ ูุฑู ุงูุณูุจูุงููู</option>
              <option>ููุฏุณุฉ ุชูู ุงูุงูุฏูุฏ</option>
              <option>ููุฏุณุฉ ูุฏููุฉ ููุช ุบูุฑ</option>
              <option>ููุฏุณุฉ ูุฑู ููุช ุบูุฑ</option>
              <option>ููุฏุณุฉ ููู ุงูููุฑ</option>
              <option>ููุฏุณุฉ ูุฏููุฉ ููุฑ ุงูุดูุฎ</option>
              <option>ููุฏุณุฉ ุบุฑุจ ููุฑ ุงูุดูุฎ</option>
              <option>ููุฏุณุฉ ุดุฑู ููุฑ ุงูุดูุฎ</option>
              <option>ููุฏุณุฉ ูููู</option>
              <option>ููุฏุณุฉ ูุฑู ุณูุฏู ุณุงูู</option>
              <option>ููุฏุณุฉ ูุฏููุฉ ุณูุฏู ุณุงูู</option>
              <option>ููุฏุณุฉ ุงูุฑูุงุถ</option>
              <option>ููุฏุณุฉ ูุฏููุฉ ุฏุณูู</option>
              <option>ููุฏุณุฉ ูุฑู ุดูุงู ุฏุณูู</option>
              <option>ููุฏุณุฉ ูุฑู ุฌููุจ ุฏุณูู</option>
              <option>ููุฏุณุฉ ููู</option>
              <option>ููุฏุณุฉ ูุทูุจุณ</option>
              <option>ููุฏุณุฉ ูุฏููุฉ ุงูุญุงููู</option>
              <option>ููุฏุณุฉ ูุฑู ุงูุญุงููู</option>
              <option>ููุฏุณุฉ ุจููุง</option>
              <option>ููุฏุณุฉ ุจูุทูู</option>
              <option>ููุฏุณุฉ ุจุฑุฌ ุงูุจุฑูุณ</option>
            </select>
            <select id="mtype" aria-label="ููุน ุงูุนุฏุงุฏ">
              <option value="">โพ ุงุฎุชุฑ ููุน ุงูุนุฏุงุฏ</option>
              <option>ุฌููุจุงู-ูุณุจู</option>
              <option>ุณููุฏู-ูุณุจู</option>
              <option>ุงููุตุฑูุฉ-ูุณุจู</option>
              <option>ุงุณูุฑุง-ูุณุจู</option>
              <option>ุฌูุฒุฉ ุจุงูุฑ-ูุณุจู</option>
              <option>ูููุงูููู</option>
              <option>ุฑููู</option>
              <option>ุนุฏุงุฏุงุช-ุฐููุฉ</option>
              <option>ุฃุฎุฑู</option>
            </select>
            <select id="removingfor" aria-label="ุณุจุจ ุงูุฑูุน">
              <option value="">ุณุจุจ ุงูุฑูุน</option>
              <option>ุงููุญุต</option>
              <option>ุงูุตูุงูุฉ</option>
              <option>ุงููุฏู ูุงูุจูุงุก</option>
              <option>ุชุตููุฉ ูุดุชุฑู</option>
              <option>ุฒูุงุฏุฉ ูุฏุฑุฉ</option>
              <option>ุงุญูุงู ุฑุจุงุนู</option>
              <option>ุชูุงุฒู</option>
              <option>ุฎุทุฉ ุงุญูุงู</option>
              <option>ุงุญูุงู ุนุฏู ุณุฏุงุฏ</option>
            </select>

            <label for="uploaddate">ุชุงุฑูุฎ ุงูุฑูุน</label>
            <input type="date" class="calibdate" id="uploaddate" placeholder="ุชุงุฑูุฎ ุงูุฑูุน" />

            <select id="mremovingfor" aria-label="ุชูุฑูุฑ ูุญุต ุงูููุฏุณุฉ">
              <option value="">ุชูุฑูุฑ ูุญุต ุงูููุฏุณุฉ</option>
              <option>ุนุทู ุจุงูุจุทุงุฑูุฉ ุงุฑุณุงูุฉ ููุดุฑูุฉ ุงูููุฑุฏุฉ ููุตูุงูุฉ</option>
              <option>
                ูุงุฑูุก ุงููุฑูุช ูุง ูุนูู ุงุฑุณุงูุฉ ููุดุฑูุฉ ุงูููุฑุฏุฉ ููุตูุงูุฉ
              </option>
              <option>
                ุงูุนุฏุงุฏ ูุง ููุจู ุงูุดุญู ุงุฑุณุงูุฉ ููุดุฑูุฉ ุงูููุฑุฏุฉ ููุตูุงูุฉ
              </option>
              <option>
                ุงูุนุฏุงุฏ ูุง ูููู ุจุงูุชูุตูู ุงุฑุณุงูุฉ ููุดุฑูุฉ ุงูููุฑุฏุฉ ููุตูุงูุฉ
              </option>
              <option>ุงูุดุงุดุฉ ุนุงุทูุฉ ุงุฑุณุงูุฉ ููุดุฑูุฉ ุงูููุฑุฏุฉ ููุตูุงูุฉ</option>
              <option>
                ุงูุนุฏุงุฏ ูุญุชุงุฌ ููุชููุฆุฉ ุงุฑุณุงูุฉ ููุดุฑูุฉ ุงูููุฑุฏุฉ ููุตูุงูุฉ
              </option>
              <option>ุชูุฑูุฑ ูุญุต ููุนุฏุงุฏ ูู ูุจู ุงูุดุฑูุฉ ุงูููุฑุฏุฉ</option>
              <option>
                ุชูู ุจุฌุณู/ุฑูุฒุชุฉ ุงูุนุฏุงุฏ ุงุฑุณุงูุฉ ููุดุฑูุฉ ุงูููุฑุฏุฉ ููุตูุงูุฉ
              </option>
              <option>ุฒูุงุฏุฉ ูุฏุฑุฉ ุงุฑุณุงูุฉ ููุดุฑูุฉ ุงูููุฑุฏุฉ ููุตูุงูุฉ</option>
              <option>ุจุญุซ ูุฏููููุฉ ุจุงูุนุฏุงุฏ ุงุฑุณุงูุฉ ููุดุฑูุฉ ุงูููุฑุฏุฉ ููุตูุงูุฉ</option>
              <option>ุงูุนุฏุงุฏ ูุญุชุฑู ุงุฑุณุงูุฉ ููุดุฑูุฉ ุงูููุฑุฏุฉ ููุตูุงูุฉ</option>
              <option>ุงูุนุฏุงุฏ ูุง ูุนูู ุงุฑุณุงูุฉ ููุดุฑูุฉ ุงูููุฑุฏุฉ ููุตูุงูุฉ</option>
              <option>
                ููุจุฉ ุงูุชูุงุนุจ ุชุนูู ุจุงุณุชูุฑุงุฑ ุงุฑุณุงูุฉ ููุดุฑูุฉ ุงูููุฑุฏุฉ ููุตูุงูุฉ
              </option>
              <option>
                ุงูุนุฏุงุฏ ูุนูู ุจุฏูู ุดุญู ุงุฑุณุงูุฉ ููุดุฑูุฉ ุงูููุฑุฏุฉ ููุตูุงูุฉ
              </option>
              <option>
                ุงูุนุฏุงุฏ ูุง ูุณุฌู ุงูุงุณุชููุงู ุงุฑุณุงูุฉ ููุดุฑูุฉ ุงูููุฑุฏุฉ ููุตูุงูุฉ
              </option>
              <option>
                ุงูุนุฏุงุฏ ูุณุฌู ุงุณุชููุงู ุจุฏูู ุญูู ุงุฑุณุงูุฉ ููุดุฑูุฉ ุงูููุฑุฏุฉ ููุตูุงูุฉ
              </option>
              <option>blocking</option>
            </select>

            <select id="takheenfor" aria-label="ุณุจุจ ุงูุชูููู">
              <option value="">โพ ุณุจุจ ุงูุชูููู</option>
              <option>ุนุงุทู</option>
              <option>ุงูุชูุงุฏู</option>
              <option>ุชูุงุนุจ</option>
              <option>ุฒูุงุฏุฉ ูุฏุฑุฉ</option>
            </select>
            <textarea id="notes" placeholder="ููุงุญุธุงุช"></textarea>
          </div>

          <div class="buttons">
            <button id="saveBtn" class="primary">ุญูุธ</button>
            <button id="editBtn" class="warning">ุชุนุฏูู</button>
            <button id="clearBtn" class="secondary">ุชูุฑูุบ</button>
            <button id="deleteBtn" class="danger">ุญุฐู</button>
          </div>
        </section>
      </div>
    </main>

    <script type="module">
      import { initializeApp } from "https://www.gstatic.com/firebasejs/10.3.1/firebase-app.js";
      import {
        getDatabase,
        ref,
        get,
        set,
        remove,
        update,
      } from "https://www.gstatic.com/firebasejs/10.3.1/firebase-database.js";

      const firebaseConfig = {
        apiKey: "AIzaSyCTSWDR3IvFpzp8UARsClrpwbRtTwr12jA",
        authDomain: "ndedc-meter-calib.firebaseapp.com",
        databaseURL: "https://ndedc-meter-calib-default-rtdb.firebaseio.com",
        projectId: "ndedc-meter-calib",
        storageBucket: "ndedc-meter-calib.appspot.com",
        messagingSenderId: "185425429190",
        appId: "1:185425429190:web:dce85f29eea55ad9f54dc7",
        measurementId: "G-C6QEKW26MW",
      };

      const app = initializeApp(firebaseConfig);
      const db = getDatabase(app);

      const el = (id) => document.getElementById(id);
      const tableBody = el("tableBody");
      const rowCount = el("rowCountValue");
      const searchInput = el("searchInput");
      let currentKey = null;

      const toast = (title, icon = "success") => {
        Swal.fire({
          title: title,
          icon: icon,
          toast: true,
          position: "top-end",
          showConfirmButton: false,
          timer: 2000,
          timerProgressBar: true,
        });
      };

      function setTodayDates() {
        const today = new Date().toISOString().split("T")[0];
        if (el("uploaddate")) el("uploaddate").value = today;
        if (el("takheendate")) el("takheendate").value = today;
      }

      function formatDate(dateStr) {
        if (!dateStr) return "";
        const date = new Date(dateStr);
        const day = String(date.getDate()).padStart(2, "0");
        const month = String(date.getMonth() + 1).padStart(2, "0");
        const year = date.getFullYear();
        return `${day}/${month}/${year}`;
      }

      async function fetchData() {
        tableBody.innerHTML =
          "<tr><td colspan='12' class='no-data-cell'>ุฌุงุฑู ุงูุชุญููู...</td></tr>";

        Swal.fire({
          title: "ุฌุงุฑู ุฌูุจ ุงูุจูุงูุงุช...",
          allowOutsideClick: false,
          didOpen: () => Swal.showLoading(),
        });

        try {
          const snap = await get(ref(db, "Takheen"));
          tableBody.innerHTML = "";
          filteredData = [];

          if (!snap.exists()) {
            tableBody.innerHTML = `
                    <tr id="noDataRow">
                        <td colspan="11" class="no-data-cell">
                            <ion-icon name="document-outline"></ion-icon>
                            <p>ูุง ุชูุฌุฏ ุจูุงูุงุช ูุนุฑุถูุง</p>
                            <p>ุงุจุฏุฃ ุจุฅุถุงูุฉ ุจูุงูุงุช ุฌุฏูุฏุฉ</p>
                        </td>
                    </tr>`;
            updateRowCount();
            Swal.close();
            return;
          }

          snap.forEach((c) => {
            const d = c.val().otherdata || c.val();
            filteredData.push(d);
            const tr = document.createElement("tr");
            tr.innerHTML = `
                        <td>${d.Type || ""}</td>
                        <td>${d.MNO || ""}</td>
                        <td>${d.MNAME || ""}</td>
                        <td>${d.Mtype || ""}</td>
                        <td>${d.Connection || ""}</td>
                        <td>${d.YEAR || ""}</td>
                        <td>${d.Keta3 || ""}</td>
                        <td>${d.Handsa || ""}</td>
                        <td>${d.Removingfor || ""}</td>
                        <td>${formatDate(d.Uploaddate)}</td>
                        <td>${d.MRemovingfor || ""}</td>
                        <td>${d.Takheenfor || ""}</td>
                        <td>${formatDate(d.Takheendate)}</td>
                        <td>${d.Notes || ""}</td>
                        <td><span class="status">ููุฏ ุงูุชูููู</span></td>
                    `;
            tr.onclick = () => fillForm(d, c.key, tr);
            tableBody.appendChild(tr);
          });

          Swal.close();
          updateRowCount();
        } catch (err) {
          Swal.fire("ุฎุทุฃ", "ูุดู ุชุญููู ุงูุจูุงูุงุช", "error");
          console.error(err);
        }
      }

      function fillForm(d, key, row) {
        currentKey = key;
        document
          .querySelectorAll(".selected-row")
          .forEach((r) => r.classList.remove("selected-row"));
        row.classList.add("selected-row");

        el("mno").value = d.MNO || "";
        el("mname").value = d.MNAME || "";
        el("type").value = d.Type || "";
        el("mconn").value = d.Connection || "";
        el("year").value = d.YEAR || "";
        el("keta3").value = d.Keta3 || "";
        el("handsa").value = d.Handsa || "";
        el("mtype").value = d.Mtype || "";
        el("removingfor").value = d.Removingfor || "";
        el("mremovingfor").value = d.MRemovingfor || "";
        el("takheenfor").value = d.Takheenfor || "";
        el("uploaddate").value = d.Uploaddate || "";
        el("notes").value = d.Notes || "";

        toast(`ุชู ุงุฎุชูุงุฑ ุงูุนุฏุงุฏ: ${d.MNO}`, "info");
      }

      async function saveData() {
        const mnoValue = el("mno").value.trim();
        if (!mnoValue) {
          Swal.fire("ุชุญุฐูุฑ", "ูุฑุฌู ุฅุฏุฎุงู ุฑูู ุงูุนุฏุงุฏ", "warning");
          return;
        }

        Swal.fire({
          title: "ุฌุงุฑู ุงูุญูุธ...",
          didOpen: () => Swal.showLoading(),
        });

        const meterData = {
          MNO: el("mno").value,
          MNAME: el("mname")?.value || "",
          Type: el("type").value,
          Connection: el("mconn").value,
          YEAR: el("year").value,
          Keta3: el("keta3").value,
          Handsa: el("handsa").value,
          Mtype: el("mtype").value,
          Removingfor: el("removingfor").value,
          MRemovingfor: el("mremovingfor").value,
          Takheenfor: el("takheenfor").value,
          Uploaddate: el("uploaddate").value,
          Takheendate: el("takheendate").value,
          Notes: el("notes").value,
          Timestamp: new Date().toISOString(),
        };

        try {
          const safeKey = mnoValue.replace(/[.#$[\]]/g, "_");
          await set(ref(db, `Takheen/${safeKey}`), { otherdata: meterData });
          await set(ref(db, `Archive_Takheen/${safeKey}`), {
            otherdata: meterData,
          });

          Swal.fire("ุชู ุงูุญูุธ!", "ุชู ุชุณุฌูู ุงูุจูุงูุงุช ุจูุฌุงุญ.", "success");
          fetchData();
          clearFilters();
        } catch (err) {
          Swal.fire("ุฎุทุฃ", "ุญุฏุซ ุฎุทุฃ ุฃุซูุงุก ุงูุญูุธ: " + err.message, "error");
        }
      }

      function updateRowCount() {
        const rows = document.querySelectorAll("#tableBody tr:not(#noDataRow)");
        rowCount.textContent = rows.length;
      }

      el("searchInput").addEventListener("input", (e) => {
        const val = e.target.value.toLowerCase();
        let visibleCount = 0;

        [...document.querySelectorAll("#tableBody tr")].forEach((row) => {
          // ุชุฌุงูู ุตู ูุง ุชูุฌุฏ ุจูุงูุงุช
          if (row.id === "noDataRow") return;

          const text = row.innerText.toLowerCase();

          if (text.includes(val)) {
            row.style.display = "";
            visibleCount++;
          } else {
            row.style.display = "none";
          }
        });

        rowCount.textContent = visibleCount;
      });

      function clearFilters() {
        document
          .querySelectorAll("input, select, textarea")
          .forEach((input) => (input.value = ""));
        setTodayDates();
        currentKey = null;
        document
          .querySelectorAll(".selected-row")
          .forEach((r) => r.classList.remove("selected-row"));
        toast("ุชู ุชูุธูู ุงููููุฐุฌ", "success");
      }

      el("saveBtn").onclick = saveData;
      el("clearBtn").onclick = clearFilters;
      el("scrollUp").onclick = () =>
        window.scrollTo({ top: 0, behavior: "smooth" });
      el("scrollDown").onclick = () =>
        window.scrollTo({
          top: document.body.scrollHeight,
          behavior: "smooth",
        });

      setTodayDates();
      fetchData();

      el("deleteBtn").onclick = () => {
        Swal.fire({
          title: "ุฌุงุฑู ุงูุงูุชูุงู",
          text: "ุณูุชู ูุชุญ ุตูุญุฉ ุงูุญุฐู",
          icon: "success",
          showConfirmButton: false,
          timer: 1200,
        });

        setTimeout(() => {
          window.location.href = "Edite_Takheen.html";
        }, 1200);
      };

      el("editBtn").onclick = () => {
        Swal.fire({
          title: "ุฌุงุฑู ุงูุงูุชูุงู",
          text: "ุณูุชู ูุชุญ ุตูุญุฉ ุงูุชุนุฏูู",
          icon: "success",
          showConfirmButton: false,
          timer: 1200,
        });

        setTimeout(() => {
          window.location.href = "Edite_Takheen.html";
        }, 1200);
      };

      let filteredData = [];

      if (exportBtn) {
        exportBtn.onclick = () => {
          if (typeof exportToExcel === "function") exportToExcel();
          else showToast("ูุธููุฉ ุงูุชุตุฏูุฑ ุบูุฑ ูุนุฑูุฉ", "error");
        };
      }

      /* ================= EXPORT ================= */
      function exportToExcel() {
        if (!filteredData.length) {
          return Swal.fire({
            icon: "warning",
            title: "ูุง ุชูุฌุฏ ุจูุงูุงุช",
            text: "ูุง ูููู ุชุตุฏูุฑ ุฌุฏูู ูุงุฑุบุ ูุฑุฌู ุงูุชุฃูุฏ ูู ูุฌูุฏ ุจูุงูุงุช ุฃููุงู",
            confirmButtonColor: "#f39c12",
          });
        }

        Swal.fire({
          title: "ุชุตุฏูุฑ ุงูุจูุงูุงุช",
          text: "ูู ุชุฑูุฏ ุชุตุฏูุฑ ุงูุฌุฏูู ุงูุญุงูู ุฅูู ููู Excelุ",
          icon: "question",
          showCancelButton: true,
          confirmButtonColor: "#27ae60",
          cancelButtonColor: "#d33",
          confirmButtonText: "ูุนู",
          cancelButtonText: "ุฅูุบุงุก",
        }).then((result) => {
          if (result.isConfirmed) {
            const dataToExport = filteredData.map((o, i) => ({
              ู: i + 1,
              "ููุน ุงููุธุงู": o.Type || "",
              "ุฑูู ุงูุนุฏุงุฏ": o.MNO || "",
              "ุงุณู ุงููุดุชุฑู": o.MNAME || "",
              "ููุน ุงูุนุฏุงุฏ": o.Mtype || "",
              "ููุน ุงูุชูุตูู": o.Connection || "",
              "ุณูุฉ ุงูุตูุน": o.YEAR || "",
              ุงููุทุงุน: o.Keta3 || "",
              ุงูููุฏุณุฉ: o.Handsa || "",
              "ุณุจุจ ุงูุฑูุน": o.Removingfor || "",
              "ุชุงุฑูุฎ ุงูุฑูุน": formatDate(o.Uploaddate),
              "ุชูุฑูุฑ ูุญุต ุงูููุฏุณุฉ": o.MRemovingfor || "",
              "ุณุจุจ ุงูุชูููู": o.Takheenfor || "",
              "ุชุงุฑูุฎ ุงูุชูููู": formatDate(o.Takheendate),
              ููุงุญุธุงุช: o.Notes || "",
              "ุญุงูุฉ ุงูุตูุงูุฉ": o.Takheenfor ? "ุชู ุงูุชูููู" : "ููุฏ ุงูุงูุชุธุงุฑ",
            }));

            const ws = XLSX.utils.json_to_sheet(dataToExport);
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, "ุงูุชูุงุฑูุฑ");
            XLSX.writeFile(
              wb,
              `ุชูุฑูุฑ_ุงูุชูููู${new Date().toISOString().slice(0, 10)}.xlsx`,
            );

            Swal.fire({
              icon: "success",
              title: "ุชู ุงูุชุตุฏูุฑ!",
              text: "ุชู ุชุญููู ููู Excel ุจูุฌุงุญ",
              timer: 1500,
              showConfirmButton: false,
            });
          }
        });
      }

      // Dropdown Menu Functionality
      const btn = document.getElementById("dropdownBtn");
      const menu = document.getElementById("dropdownMenu");

      btn.addEventListener("click", () => {
        menu.style.display = menu.style.display === "block" ? "none" : "block";
      });

      document.querySelectorAll(".dropdown-item[data-page]").forEach((item) => {
        item.addEventListener("click", () => {
          const page = item.dataset.page;
          window.open(page, "_blank"); // ูุชุญ ูู ุชุจููุจ ุฌุฏูุฏ
        });
      });

      // ุฅุบูุงู ุนูุฏ ุงูุถุบุท ุฎุงุฑุฌ ุงููุงุฆูุฉ
      document.addEventListener("click", (e) => {
        if (!e.target.closest(".modern-dropdown")) {
          menu.style.display = "none";
        }
      });
    </script>
  </body>

  </html>