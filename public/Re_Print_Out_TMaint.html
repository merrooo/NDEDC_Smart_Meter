<!DOCTYPE html>
    <html lang="ar">

    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <title>Ø§Ù„ØµÙŠØ§Ù†Ø©</title>
        <link rel="stylesheet" type="text/css" href="Re_Print_Out_TMaint.css">
        <link rel="stylesheet" href="print.css" media="print">
        <!-- for export pdf and make it valid -->
        <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
        <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600&display=swap" rel="stylesheet">
        <!-- for export excell and make it valid  -->
        <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
        <!-- Add icon library -->
        <script type="module" src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.esm.js"></script>
    </head>

    <body>
        <div id="content-to-export">
            <div id="page-content" dir="rtl">
                <!-- ================= SIDEBAR ================= -->
                <div class="sidebar">
                    <h2>ğŸ  Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</h2>
                    <div class="search-filters">
                        <div class="input-container"><select id="mtype" class="text_name_1" aria-label="Ù†ÙˆØ¹ Ø§Ù„Ø¹Ø¯Ø§Ø¯">
                                <option value="">Ù†ÙˆØ¹ Ø§Ù„Ø¹Ø¯Ø§Ø¯ â–¾</option>
                            </select></div>
                        <div class="input-container"><select id="mconn" class="text_name_1" aria-label="Ù†ÙˆØ¹ Ø§Ù„ØªÙˆØµÙŠÙ„">
                                <option value="">Ù†ÙˆØ¹ Ø§Ù„ØªÙˆØµÙŠÙ„ â–¾</option>
                            </select></div>
                        <div class="input-container"><select id="keta3" class="text_name_1" aria-label="Ø§Ù„Ù‚Ø·Ø§Ø¹">
                                <option value="">Ø§Ù„Ù‚Ø·Ø§Ø¹ â–¾</option>
                            </select></div>
                        <div class="input-container"><select id="handsa" class="text_name_1" aria-label="Ø§Ù„Ù‡Ù†Ø¯Ø³Ø©">
                                <option value="">Ø§Ù„Ù‡Ù†Ø¯Ø³Ø© â–¾</option>
                            </select></div>
                    </div>
                </div>

                <!-- ================= HEADER ================= -->
                <div class="container-logo">
                    <input type="date" class="text_name_date" id="printtDate" readonly>
                    <h1>ØªÙ‚Ø±ÙŠØ± Ù…Ø¬Ù…Ø¹ ØªØ³Ù„ÙŠÙ… ØµÙŠØ§Ù†Ø© Ø¹Ø¯Ø§Ø¯Ø§Øª</h1>
                    <img src="Energy4.png" alt="Logo">
                </div>

                <!-- ================= CARD ================= -->
                <div class="cards-wrapper-1">
                    <div class="card_1" id="card_1">
                        <div class="button-container">
                            <button id="btnexcell">ØªØµØ¯ÙŠØ± Ø¥Ù„Ù‰ Excel</button>
                            <button id="dlt_btn">ØªØ³Ù„ÙŠÙ… ØªÙ‚Ø±ÙŠØ±</button>
                        </div>

                        <div class="input-container">
                            <input type="checkbox" id="chkbx" class="chkbx">
                            <label for="chkbx" class="label_chkbx">ØªØ³Ù„ÙŠÙ… Ø§Ù„Ø¹Ø¯Ø§Ø¯Ø§Øª</label>
                            <div class="input-group">
                                <input id="reciver" class="text_name_2" type="text" placeholder=" ">
                                <span class="label_1">Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªÙ„Ù…</span>
                            </div>
                            <div class="input-group">
                                <input id="betaka" class="text_name_2" type="text" placeholder=" ">
                                <span class="label_1">Ø±Ù‚Ù… Ø§Ù„Ø¨Ø·Ø§Ù‚Ø©</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- // ================= SCRIPT TO ENABLE/DISABLE INPUTS ================= ! -->
                <script>
                    const chkbox = document.getElementById("chkbx");
                    const reciverInput = document.getElementById("reciver");
                    const betakaInput = document.getElementById("betaka");

                    chkbox.addEventListener("change", () => {
                        const enabled = chkbox.checked;
                        reciverInput.disabled = !enabled;
                        betakaInput.disabled = !enabled;

                        // Optional: add a visual effect
                        if (enabled) {
                            reciverInput.classList.add("active-card-input");
                            betakaInput.classList.add("active-card-input");
                        } else {
                            reciverInput.classList.remove("active-card-input");
                            betakaInput.classList.remove("active-card-input");
                        }
                    });

                </script>

                <!-- ================= TABLE ================= -->
                <div class="table-wrapper">
                    <div class="table-container">
                        <table id="dataTable" border="2">
                            <thead>
                                <tr>
                                    <th>Ø±Ù‚Ù… Ø§Ù„Ø¹Ø¯Ø§Ø¯</th>
                                    <th>Ù†ÙˆØ¹ Ø§Ù„Ø¹Ø¯Ø§Ø¯</th>
                                    <th>Ù†ÙˆØ¹ Ø§Ù„ØªÙˆØµÙŠÙ„</th>
                                    <th>Ø³Ù†Ø© Ø§Ù„ØµÙ†Ø¹</th>
                                    <th>Ø§Ù„Ù‚Ø±Ø§Ø¡Ø© Ù‚Ø¨Ù„ Ø§Ù„ÙØ­Øµ</th>
                                    <th>Ù‚ÙˆØ© Ø§Ù„Ø¹Ø¯Ø§Ø¯</th>
                                    <th>Ø§Ù„Ù‚Ø·Ø§Ø¹</th>
                                    <th>Ø§Ù„Ù‡Ù†Ø¯Ø³Ø©</th>
                                    <th>Ø³Ø¨Ø¨ Ø§Ù„Ø±ÙØ¹</th>
                                    <th>ØªØ§Ø±ÙŠØ® Ø§Ù„Ø±ÙØ¹ Ø§Ù„Ù‡Ù†Ø¯Ø³Ø©</th>
                                    <th>ØªØ§Ø±ÙŠØ® Ø¯Ø®ÙˆÙ„ Ø§Ù„ØµÙŠØ§Ù†Ø©</th>
                                    <th>ØªØ§Ø±ÙŠØ® ØµÙŠØ§Ù†Ø© Ø§Ù„Ø¹Ø¯Ø§Ø¯Ø§Øª</th>
                                    <th>ØªÙ‚Ø±ÙŠØ± Ø§Ù„ØµÙŠØ§Ù†Ø©</th>
                                </tr>
                            </thead>
                            <tbody></tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <!-- ğŸ§­ Scroll Up/Down Buttons -->
        <div class="scroll-buttons">
            <button id="scrollUp" title="Ø¥Ù„Ù‰ Ø§Ù„Ø£Ø¹Ù„Ù‰">â–²</button>
            <button id="scrollDown" title="Ø¥Ù„Ù‰ Ø§Ù„Ø£Ø³ÙÙ„">â–¼</button>
        </div>

        <!-- // -----------------------------------------------ğŸ§­ Scroll Up/Down Buttons ------------------------------------------------------------------>

        <script>
            document.getElementById("scrollUp").addEventListener("click", () => {
                window.scrollTo({ top: 0, behavior: "smooth" });
            });

            document.getElementById("scrollDown").addEventListener("click", () => {
                window.scrollTo({ top: document.body.scrollHeight, behavior: "smooth" });
            });
        </script>

        <!-- // ------------------------------------------------------Dropdown Menu---------------------------------------------------------------------->

        <script>
            document.addEventListener("DOMContentLoaded", () => {
                const dropdownButtons = document.querySelectorAll(".dropdown-btn");

                dropdownButtons.forEach((btn) => {
                    btn.addEventListener("click", (event) => {
                        event.stopPropagation(); // prevent body click handler
                        const currentDropdown = btn.nextElementSibling;

                        // Close all other dropdowns
                        document.querySelectorAll(".dropdown-content").forEach((content) => {
                            if (content !== currentDropdown) {
                                content.classList.remove("active");
                            }
                        });

                        // Toggle the current dropdown
                        currentDropdown.classList.toggle("active");
                    });
                });

                // Close all dropdowns when clicking outside
                document.addEventListener("click", () => {
                    document.querySelectorAll(".dropdown-content").forEach((content) => {
                        content.classList.remove("active");
                    });
                });
            });
        </script>

        <script>
            document.getElementById('printtDate').value = new Date().toISOString().split('T')[0];
        </script>

        <script type="module">
            import { initializeApp } from "https://www.gstatic.com/firebasejs/10.3.1/firebase-app.js";
            import { getDatabase, ref, get, remove, set } from "https://www.gstatic.com/firebasejs/10.3.1/firebase-database.js";

            const firebaseConfig = {
                apiKey: "AIzaSyCTSWDR3IvFpzp8UARsClrpwbRtTwr12jA",
                authDomain: "ndedc-meter-calib.firebaseapp.com",
                databaseURL: "https://ndedc-meter-calib-default-rtdb.firebaseio.com",
                projectId: "ndedc-meter-calib",
                storageBucket: "ndedc-meter-calib.appspot.com",
                messagingSenderId: "185425429190",
                appId: "1:185425429190:web:dce85f29eea55ad9f54dc7",
                measurementId: "G-C6QEKW26MW"
            };

            const app = initializeApp(firebaseConfig);
            const db = getDatabase(app);


            // ------------------------------------------------------ FetchAllDataToTable ------------------------------------------------------
            let allData = [];

            async function fetchAllDataToTable() {
                try {
                    const dbRef = ref(db, "Archive_Maint"); // âœ… Removed extra space
                    const snapshot = await get(dbRef);

                    allData = [];
                    const mtypeSet = new Set();
                    const mconnSet = new Set();
                    const keta3Set = new Set();
                    const handsaSet = new Set();

                    if (snapshot.exists()) {
                        snapshot.forEach(childSnapshot => {
                            const d = childSnapshot.val().otherdata || {};
                            allData.push(d);
                            if (d.Mtype) mtypeSet.add(d.Mtype);
                            if (d.Connection) mconnSet.add(d.Connection);
                            if (d.Keta3) keta3Set.add(d.Keta3);
                            if (d.Handsa) handsaSet.add(d.Handsa);
                        });
                    }

                    fillDropdown("mtype", mtypeSet, "Ù†ÙˆØ¹ Ø§Ù„Ø¹Ø¯Ø§Ø¯ ");
                    fillDropdown("mconn", mconnSet, "Ù†ÙˆØ¹ Ø§Ù„ØªÙˆØµÙŠÙ„ ");
                    fillDropdown("keta3", keta3Set, "Ø§Ù„Ù‚Ø·Ø§Ø¹ ");
                    fillDropdown("handsa", handsaSet, "Ø§Ù„Ù‡Ù†Ø¯Ø³Ø© ");

                    renderTable(allData);
                } catch (error) {
                    console.error("Error fetching data:", error);
                    shakeContainer();
                }
            }

            function fillDropdown(id, set, label) {
                const select = document.getElementById(id);
                select.innerHTML = `<option value="">${label}</option>`;
                set.forEach(val => {
                    const option = document.createElement("option");
                    option.value = val;
                    option.textContent = val;
                    select.appendChild(option);
                });
            }

            function renderTable(filteredData) {
                const tableBody = document.querySelector("#dataTable tbody");
                tableBody.innerHTML = "";
                if (!filteredData.length) {
                    shakeContainer();
                    tableBody.innerHTML = `<tr><td colspan="12">âŒ Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø·Ø§Ø¨Ù‚Ø©.</td></tr>`;
                    return;
                }
                filteredData.forEach(d => {
                    const row = document.createElement("tr");
                    row.innerHTML = `
                    <td>${d.MNO || ""}</td>
                    <td>${d.Mtype || ""}</td>
                    <td>${d.Connection || ""}</td>
                    <td>${d.YEAR || ""}</td>
                    <td>${d.MREADING || ""}</td>
                    <td>${d.MPower || ""}</td>
                    <td>${d.Keta3 || ""}</td>
                    <td>${d.Handsa || ""}</td>
                    <td>${d.Removingfor || ""}</td>
                    <td>${d.Uploaddate || ""}</td>
                    <td>${d.Enter_Maint_Date || ""}</td>
                    <td>${d.Maint_Date || ""}</td>
                    <td>${d.Mremovingfor || ""}</td>
                `;
                    tableBody.appendChild(row);
                });
            }

            function filterAndRender() {
                const mtype = document.getElementById("mtype").value;
                const mconn = document.getElementById("mconn").value;
                const keta3 = document.getElementById("keta3").value;
                const handsa = document.getElementById("handsa").value;

                let filtered = allData.filter(d => {
                    return (!mtype || d.Mtype === mtype)
                        && (!mconn || d.Connection === mconn)
                        && (!keta3 || d.Keta3 === keta3)
                        && (!handsa || d.Handsa === handsa);
                });
                renderTable(filtered);
            }

            document.addEventListener("DOMContentLoaded", () => {
                // attach change listeners so dropdowns filter the table
                ["mtype", "mconn", "keta3", "handsa"].forEach(id => {
                    const el = document.getElementById(id);
                    if (el) el.addEventListener("change", filterAndRender);
                });

                fetchAllDataToTable();
            });

            // ------------------------------------------------------ AddModifyArchiveData (bulk) ------------------------------------------------------>
            async function AddModifyArchiveData() {
                const reciverEl = document.getElementById("reciver");
                const betakaEl = document.getElementById("betaka");
                const reciver1 = (reciverEl?.value || "").trim();
                const betaka1 = (betakaEl?.value || "").trim();

                if (!reciver1 || !betaka1) {
                    alert("âŒ Ø§Ù„Ø±Ø¬Ø§Ø¡ ØªÙØ¹ÙŠÙ„ ÙˆØ§Ø³ØªÙƒÙ…Ø§Ù„ Ø¨ÙŠØ§Ù†Ø§Øª ØªØ³Ù„ÙŠÙ… Ø§Ù„Ø¹Ø¯Ø§Ø¯Ø§Øª!");
                    shakeContainer();
                    return false;
                }

                const tableRows = document.querySelectorAll("#dataTable tbody tr");
                if (tableRows.length === 0) {
                    alert("âŒ Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù„Ø­ÙØ¸!");
                    return false;
                }

                const currentDate = document.getElementById("printtDate")?.value || "";

                // âœ… Ask once before saving
                if (!confirm("âš ï¸ Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† ØªØ³Ù„ÙŠÙ… Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¹Ø¯Ø§Ø¯Ø§Øª ")) {
                    return false;
                }

                try {
                    for (const row of tableRows) {
                        const datatable = {
                            MNO: row.cells[0]?.textContent.trim(),
                            Mtype: row.cells[1]?.textContent.trim(),
                            Connection: row.cells[2]?.textContent.trim(),
                            YEAR: row.cells[3]?.textContent.trim(),
                            MREADING: row.cells[4]?.textContent.trim(),
                            MPower: row.cells[5]?.textContent.trim(),
                            Keta3: row.cells[6]?.textContent.trim(),
                            Handsa: row.cells[7]?.textContent.trim(),
                            Removingfor: row.cells[8]?.textContent.trim(),
                            Uploaddate: row.cells[9]?.textContent.trim(),
                            Enter_Maint_Date: row.cells[10]?.textContent.trim(),
                            Maint_Date: row.cells[11]?.textContent.trim(),
                            Mremovingfor: row.cells[12]?.textContent.trim(),
                        };

                        const mnoValue = datatable.MNO;
                        if (!mnoValue) continue;

                        const data = {
                            otherdata: {
                                Reciver1: reciver1,
                                Betaka1: betaka1,
                                CurrentDate: currentDate
                            },
                            datatable: datatable
                        };

                        await set(ref(db, "Reciever_Maint/" + mnoValue), data);
                    }

                    return true;
                } catch (err) {
                    console.error(err);
                    alert("âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø­ÙØ¸: " + err.message);
                    shakeContainer();
                    return false;
                }
            }

            // ------------------------------------------------------ DeleteMeterData (bulk) ------------------------------------------------------>
            async function DeleteMeterData() {
                const password = prompt("ğŸ”‘ Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ù„Ø­Ø°Ù Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø¹Ø±ÙˆØ¶Ø© ÙÙŠ Ø§Ù„Ø¬Ø¯ÙˆÙ„ ÙÙ‚Ø·:");
                const correctPassword = "123";

                if (password !== correctPassword) {
                    alert("âŒ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ØºÙŠØ± ØµØ­ÙŠØ­Ø©. Ù„Ø§ ÙŠÙ…ÙƒÙ† ØªÙ†ÙÙŠØ° Ø§Ù„Ø­Ø°Ù.");
                    shakeContainer();
                    return;
                }

                const tableRows = document.querySelectorAll("#dataTable tbody tr");
                if (tableRows.length === 0) {
                    alert("âŒ Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø¹Ø±ÙˆØ¶Ø© Ù„Ù„Ø­Ø°Ù.");
                    shakeContainer();
                    return;
                }

                try {
                    for (const row of tableRows) {
                        const mnoValue = row.cells[0]?.textContent.trim();
                        if (!mnoValue) continue;

                        await remove(ref(db, "Maint/" + mnoValue));
                    }

                    await fetchAllDataToTable();
                } catch (error) {
                    alert("âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø­Ø°Ù: " + error.message);
                    shakeContainer();
                    console.error(error);
                }
            }

            // ------------------------------------------------------button----------------------------------------------------------------->

            function exportTableToExcelWithTitleAndRowCount(tableID, filename = 'ØªÙ‚Ø±ÙŠØ± Ø§Ù„ØµÙŠØ§Ù†Ø©.xlsx') {
                const table = document.getElementById(tableID);
                const rows = table.rows;

                const data = [];
                let filledRowCount = 0;
                const columnCount = rows[0].cells.length;

                // Get filter values for Ù‡Ù†Ø¯Ø³Ø© and Ù‚Ø·Ø§Ø¹ (actual values, not label)
                const handsaSelect = document.getElementById("handsa");
                const handsa = handsaSelect.options[handsaSelect.selectedIndex].value || "";
                const keta3Select = document.getElementById("keta3");
                const keta3 = keta3Select.options[keta3Select.selectedIndex].value || "";
                const today = new Date().toISOString().split('T')[0];

                // 1. Title row (centered)
                const titleRow = new Array(columnCount).fill('');
                titleRow[0] = 'ğŸ“‹ ØªÙ‚Ø±ÙŠØ± Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ØµÙŠØ§Ù†Ø©';
                data.push(titleRow);

                // 2. Info row: right Ù‡Ù†Ø¯Ø³Ø©, next Ù‚Ø·Ø§Ø¹, left Ø§Ù„ØªØ§Ø±ÙŠØ®
                const infoRow = new Array(columnCount).fill('');
                infoRow[0] = handsa;
                infoRow[1] = keta3;
                infoRow[columnCount - 1] = today;
                data.push(infoRow);

                // 3. Table header row
                const headerRow = [];
                for (let j = 0; j < columnCount; j++) {
                    headerRow.push(rows[0].cells[j].innerText || rows[0].cells[j].textContent);
                }
                data.push(headerRow);

                // 4. Data rows
                for (let i = 1; i < rows.length; i++) {
                    const row = [];
                    let hasValue = false;
                    for (let j = 0; j < columnCount; j++) {
                        const cellValue = rows[i].cells[j].innerText || rows[i].cells[j].textContent;
                        row.push(cellValue);
                        if (cellValue.trim() !== '') {
                            hasValue = true;
                        }
                    }
                    data.push(row);
                    if (hasValue) filledRowCount++;
                }

                // 5. Total row
                const totalRow = new Array(columnCount).fill('');
                totalRow[0] = 'âœ… Ø§Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¹Ø¯Ø§Ø¯Ø§Øª ';
                totalRow[columnCount - 1] = filledRowCount.toString();
                data.push(totalRow);

                // 6. Create worksheet
                const worksheet = XLSX.utils.aoa_to_sheet(data);

                worksheet['!merges'] = [
                    // Merge title row
                    { s: { r: 0, c: 0 }, e: { r: 0, c: columnCount - 1 } },
                    // Merge Ù‡Ù†Ø¯Ø³Ø© and Ù‚Ø·Ø§Ø¹ (info row)
                    { s: { r: 1, c: 0 }, e: { r: 1, c: 1 } },
                    // Merge date cell (info row)
                    { s: { r: 1, c: columnCount - 1 }, e: { r: 1, c: columnCount - 1 } },
                    // Merge total row label
                    { s: { r: data.length - 1, c: 0 }, e: { r: data.length - 1, c: columnCount - 2 } }
                ];

                // 7. Optional styling (only works with some viewers)
                const titleCell = XLSX.utils.encode_cell({ r: 0, c: Math.floor(columnCount / 2) });
                worksheet[titleCell].s = {
                    font: { bold: true, sz: 16, color: { rgb: "FFFFFF" } },
                    fill: { fgColor: { rgb: "2563eb" } },
                    alignment: { horizontal: "center", vertical: "center" }
                };

                const handsaCell = XLSX.utils.encode_cell({ r: 1, c: 0 });
                worksheet[handsaCell].s = {
                    font: { bold: true, color: { rgb: "2563eb" } },
                    alignment: { horizontal: "right" }
                };

                const keta3Cell = XLSX.utils.encode_cell({ r: 1, c: 1 });
                worksheet[keta3Cell].s = {
                    font: { bold: true, color: { rgb: "2563eb" } },
                    alignment: { horizontal: "right" }
                };

                const dateCell = XLSX.utils.encode_cell({ r: 1, c: columnCount - 1 });
                worksheet[dateCell].s = {
                    font: { bold: true, color: { rgb: "2563eb" } },
                    alignment: { horizontal: "left" }
                };

                const totalLabelCell = XLSX.utils.encode_cell({ r: data.length - 1, c: 0 });
                worksheet[totalLabelCell].s = {
                    font: { bold: true },
                    fill: { fgColor: { rgb: "DDDDDD" } },
                    alignment: { horizontal: "center" }
                };

                const totalValueCell = XLSX.utils.encode_cell({ r: data.length - 1, c: columnCount - 1 });
                worksheet[totalValueCell].s = {
                    font: { bold: true },
                    fill: { fgColor: { rgb: "FFFFCC" } },
                    alignment: { horizontal: "center" }
                };

                // 8. Set RTL direction (for supported viewers)
                worksheet['!rtl'] = true;

                // 9. Export
                const workbook = XLSX.utils.book_new();
                XLSX.utils.book_append_sheet(workbook, worksheet, 'ØªÙ‚Ø±ÙŠØ± ØµÙŠØ§Ù†Ø© Ø§Ù„Ø¹Ø¯Ø§Ø¯Ø§Øª');
                XLSX.writeFile(workbook, filename);

            }

            // ------------------------------------------------------ Show/Hide Sidebar ------------------------------------------------------>

            function hideall() {
                const items = [
                    document.querySelector(".sidebar"),
                    document.getElementById("Print_btn"),
                    document.getElementById("btnexcell"),
                    document.getElementById("dlt_btn"),
                ];

                items.forEach(el => {
                    if (el) el.style.display = "none";
                });
            }

            function showall() {
                const items = [
                    document.querySelector(".sidebar"),
                    document.getElementById("Print_btn"),
                    document.getElementById("btnexcell"),
                    document.getElementById("dlt_btn"),
                ];

                items.forEach(el => {
                    if (el) el.style.display = "block";
                });
            }


            // ------------------------------------------------------ Delete Button Handler with PDF before delete ------------------------------------------------------>

            const btnDelete = document.getElementById('dlt_btn');
            if (btnDelete) {
                btnDelete.addEventListener('click', async () => {

                    // ------------------------------------------------------------------
                    // 0ï¸âƒ£ FIRST: CHECK EVERYTHING IS OK BEFORE PDF OR DELETE
                    // ------------------------------------------------------------------
                    const added = await AddModifyArchiveData();
                    if (!added) {
                        console.log("âŒ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ØºÙŠØ± Ù…ÙƒØªÙ…Ù„Ø© â€“ Ù„Ù† ÙŠØªÙ… Ø·Ø¨Ø§Ø¹Ø© PDF Ø£Ùˆ Ø§Ù„Ø­Ø°Ù.");
                        return; // stop everything
                    }

                    // ------------------------------------------------------------------
                    // 1ï¸âƒ£ DOWNLOAD PDF
                    // ------------------------------------------------------------------
                    const element = document.getElementById('page-content');

                    const opt = {
                        margin: [1, 1, -75, -12],
                        filename: 'Meter_Maintainance_Report.pdf',
                        image: { type: 'jpeg', quality: 1 },
                        html2canvas: {
                            scale: 2,
                            useCORS: true,
                            scrollX: 0,
                            scrollY: 0,
                            letterRendering: true
                        },
                        jsPDF: {
                            unit: 'px',
                            format: [1123, 844],
                            orientation: 'landscape'
                        }
                    };

                    hideall();

                    const originalTransform = element.style.transform;
                    const originalOrigin = element.style.transformOrigin;

                    element.style.transformOrigin = 'top center';
                    element.style.transform = 'scale(0.80)';

                    try {
                        await html2pdf().set(opt).from(element).save();
                    } catch (error) {
                        console.error("Error while generating PDF:", error);
                    } finally {
                        element.style.transform = originalTransform;
                        element.style.transformOrigin = originalOrigin;
                        showall();
                    }

                    // ------------------------------------------------------------------
                    // 2ï¸âƒ£ NOW DELETE THE METER
                    // ------------------------------------------------------------------
                    await DeleteMeterData();

                    // ------------------------------------------------------------------
                    // 3ï¸âƒ£ FINALLY REFRESH ALL DATA
                    // ------------------------------------------------------------------
                    if (typeof FetchAllData === "function") {
                        await FetchAllData();
                    }

                    console.log("âœ” Ø§Ù„Ø¹Ù…Ù„ÙŠØ© ØªÙ…Øª Ø¨Ø§Ù„ÙƒØ§Ù…Ù„: PDF + Ø£Ø±Ø´ÙØ© + Ø­Ø°Ù + ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¬Ø¯ÙˆÙ„");
                });
            }

            /* -----------------------------------SHAKE FUNCTION----------------------------------- */

            function shakeContainer() {
                const items = ["chkbx", "reciver", "betaka"]; // IDs you want to shake

                items.forEach(id => {
                    const box = document.getElementById(id);
                    if (box) {
                        box.classList.add("container-shake");
                        setTimeout(() => box.classList.remove("container-shake"), 500);
                    }
                });
            }

        </script>
    </body>

    </html>